<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#f0f4f8">
    <meta name="description" content="ÙˆØ¨â€ŒØ§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ù…Ø¯ÛŒØ±ÛŒØª Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù…Ø­ØµÙˆÙ„Ø§Øª - Ú¯Ø±ÙˆÙ‡ Ù‡Ù†Ø±ÛŒ Ø§Ù‚Ø§Ù‚ÛŒØ§">
    <title>Radical Indexer Pro v3.5</title>
    <link rel="manifest" href="manifest.json">
    <style>
        /* ØªÙ… Ø±ÙˆØ´Ù† (Ù¾ÛŒØ´â€ŒÙØ±Ø¶) */
        :root {
            --primary: #3b82f6;
            --primary-light: #60a5fa;
            --primary-dark: #2563eb;
            --secondary: #10b981;
            --secondary-light: #34d399;
            --secondary-dark: #059669;
            --accent: #f59e0b;
            --accent-light: #fbbf24;
            --accent-dark: #d97706;
            --danger: #ef4444;
            --warning: #f59e0b;
            --success: #10b981;
            --info: #3b82f6;
            
            --bg-primary: #f8fafc;
            --bg-secondary: #f1f5f9;
            --bg-card: #ffffff;
            --bg-hover: #f8fafc;
            
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-light: #94a3b8;
            --text-on-primary: #ffffff;
            
            --border: #e2e8f0;
            --border-light: #f1f5f9;
            --border-dark: #cbd5e1;
            
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            
            --radius-sm: 0.375rem;
            --radius: 0.5rem;
            --radius-md: 0.75rem;
            --radius-lg: 1rem;
            --radius-xl: 1.5rem;
            
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ØªÙ… ØªÛŒØ±Ù‡ */
        .dark-theme {
            --primary: #60a5fa;
            --primary-light: #93c5fd;
            --primary-dark: #2563eb;
            --secondary: #34d399;
            --secondary-light: #6ee7b7;
            --secondary-dark: #059669;
            --accent: #fbbf24;
            --accent-light: #fcd34d;
            --accent-dark: #d97706;
            --danger: #f87171;
            --warning: #fbbf24;
            --success: #34d399;
            --info: #60a5fa;
            
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #334155;
            --bg-hover: #475569;
            
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-light: #94a3b8;
            --text-on-primary: #ffffff;
            
            --border: #475569;
            --border-light: #64748b;
            --border-dark: #334155;
        }

        /* Ø±ÛŒØ³Øª Ø§Ø³ØªØ§ÛŒÙ„ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Vazirmatn', -apple-system, BlinkMacSystemFont, 'Segoe UI', Tahoma, sans-serif;
        }

        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            font-size: 14px;
            line-height: 1.6;
            overflow-x: hidden;
            transition: var(--transition);
        }

        /* Ø¯Ú©Ù…Ù‡ Ù†ØµØ¨ PWA */
        .install-prompt {
            position: fixed;
            top: 20px;
            left: 20px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            z-index: 10000;
            display: none;
            box-shadow: var(--shadow-lg);
            animation: pulse 2s infinite;
            font-size: 14px;
            backdrop-filter: blur(10px);
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.5); }
            70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }

        /* Ø¯Ú©Ù…Ù‡ ØªØºÛŒÛŒØ± ØªÙ… */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-card);
            color: var(--text-primary);
            border: 1px solid var(--border);
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 10000;
            box-shadow: var(--shadow);
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
        }

        .theme-toggle:hover {
            transform: rotate(30deg);
            box-shadow: var(--shadow-md);
        }

        /* Ú©Ø§Ù†ØªÛŒÙ†Ø± Ø§ØµÙ„ÛŒ */
        .main-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Ù†ÙˆÛŒÚ¯ÛŒØ´Ù† */
        .app-nav {
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            padding: 20px 30px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .nav-brand h1 {
            font-size: 24px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }

        .nav-tabs {
            display: flex;
            gap: 8px;
            background: var(--bg-secondary);
            padding: 4px;
            border-radius: var(--radius-lg);
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            font-size: 14px;
            white-space: nowrap;
        }

        .nav-tab.active, .nav-tab:hover {
            background: var(--bg-card);
            color: var(--primary);
            box-shadow: var(--shadow);
        }

        /* Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø§Ø± */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .stat-card h3 {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        .stat-card .value {
            font-size: 28px;
            font-weight: 800;
            color: var(--text-primary);
        }

        /* ØªØ¨ Ù…Ø­ØªÙˆØ§ */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ØªÙ†Ø¸ÛŒÙ…Ø§Øª */
        .settings-section {
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .section-title {
            font-size: 20px;
            color: var(--text-primary);
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--border);
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
        }

        .setting-group {
            background: var(--bg-secondary);
            padding: 24px;
            border-radius: var(--radius-lg);
            border-right: 4px solid var(--primary);
        }

        .setting-label {
            display: block;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
        }

        .setting-input {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            color: var(--text-primary);
            font-size: 14px;
            transition: var(--transition);
        }

        .setting-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border-radius: var(--radius);
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 14px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), var(--secondary-dark));
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), var(--accent-dark));
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            color: white;
        }

        /* ÙØ±Ø¢ÛŒÙ†Ø¯ Ø§ÛŒÙ†Ø¯Ú©Ø³ */
        .index-process {
            background: var(--bg-secondary);
            padding: 24px;
            border-radius: var(--radius-lg);
            margin-top: 20px;
            border: 2px solid var(--border);
        }

        .process-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .process-stats {
            display: flex;
            gap: 24px;
            flex-wrap: wrap;
        }

        .process-stat {
            text-align: center;
        }

        .process-stat .label {
            color: var(--text-secondary);
            font-size: 12px;
            margin-bottom: 4px;
            font-weight: 600;
        }

        .process-stat .value {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
        }

        .progress-bar-container {
            margin: 24px 0;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .progress-bar {
            height: 10px;
            background: var(--border);
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 5px;
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.4), 
                transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ†Ø¯Ú©Ø³ */
        .index-controls {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .index-btn {
            flex: 1;
            min-width: 180px;
            padding: 14px 20px;
        }

        /* ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ */
        .filters-bar {
            background: var(--bg-card);
            padding: 20px;
            border-radius: var(--radius-lg);
            margin-bottom: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }

        .filter-row {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .filter-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            font-size: 14px;
            cursor: pointer;
        }

        .filter-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            cursor: pointer;
        }

        .filter-checkbox input[type="checkbox"]:checked {
            background-color: var(--primary);
            border-color: var(--primary);
        }

        .price-adjustment-panel {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: var(--radius-lg);
            margin-top: 20px;
            border: 1px solid var(--border);
        }

        /* Ø¬Ø¯ÙˆÙ„ Ù…Ø­ØµÙˆÙ„Ø§Øª */
        .products-table-container {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            overflow-x: auto;
        }

        .table-wrapper {
            position: relative;
            max-height: 600px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: var(--radius);
        }

        .table-wrapper table {
            width: 100%;
            min-width: 1200px;
            border-collapse: separate;
            border-spacing: 0;
        }

        .sticky-header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: var(--bg-card);
            box-shadow: var(--shadow-sm);
        }

        .sticky-header th {
            position: sticky;
            top: 0;
            background: var(--bg-secondary);
            z-index: 101;
        }

        th {
            padding: 16px 12px;
            text-align: right;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-weight: 700;
            font-size: 14px;
            border-bottom: 2px solid var(--border);
            cursor: pointer;
            user-select: none;
            white-space: nowrap;
            transition: var(--transition);
        }

        th:hover {
            background: var(--bg-hover);
        }

        th.sortable {
            position: relative;
            padding-right: 30px;
        }

        th.sortable.asc::after {
            content: "â†‘";
            position: absolute;
            right: 12px;
            color: var(--primary);
        }

        th.sortable.desc::after {
            content: "â†“";
            position: absolute;
            right: 12px;
            color: var(--primary);
        }

        td {
            padding: 16px 12px;
            border-bottom: 1px solid var(--border-light);
            vertical-align: middle;
            transition: var(--transition);
        }

        tr:hover td {
            background: var(--bg-hover);
        }

        .product-link {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-block;
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .product-link:hover {
            color: var(--primary-dark);
            text-decoration: underline;
        }

        .price-badge {
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 12px;
            display: inline-block;
            min-width: 100px;
            text-align: center;
        }

        .yield-badge {
            background: linear-gradient(135deg, var(--secondary-light), var(--secondary));
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 12px;
            display: inline-block;
            min-width: 100px;
            text-align: center;
        }

        .price-input-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .price-input {
            width: 140px;
            padding: 10px 12px;
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            color: var(--text-primary);
            font-size: 14px;
            text-align: center;
            transition: var(--transition);
        }

        .price-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .save-price-btn {
            padding: 8px 12px;
            background: var(--success);
            color: white;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .save-price-btn:hover {
            background: var(--secondary-dark);
        }

        .action-btn {
            padding: 8px 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
            font-size: 12px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .action-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ù…Ø­ØµÙˆÙ„ */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-y: auto;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            width: 100%;
            max-width: 1000px;
            max-height: 90vh;
            overflow-y: auto;
            border-radius: var(--radius-xl);
            animation: slideUp 0.4s ease;
            position: relative;
            background: var(--bg-card);
            box-shadow: var(--shadow-lg);
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-card));
            border-radius: var(--radius-xl) var(--radius-xl) 0 0;
        }

        .modal-header h2 {
            font-size: 20px;
            color: var(--text-primary);
            margin-right: 20px;
            flex: 1;
            font-weight: 700;
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            line-height: 1;
            transition: var(--transition);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius);
        }

        .close-modal:hover {
            color: var(--danger);
            background: var(--bg-secondary);
        }

        .modal-body {
            padding: 24px;
        }

        .product-main-image {
            width: 100%;
            max-height: 300px;
            object-fit: contain;
            border-radius: var(--radius-lg);
            margin-bottom: 24px;
            border: 2px solid var(--border);
            box-shadow: var(--shadow);
        }

        .product-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .detail-card {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: var(--radius);
            border-left: 4px solid var(--primary);
        }

        .detail-label {
            display: block;
            color: var(--text-secondary);
            font-size: 12px;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .detail-value {
            font-size: 16px;
            color: var(--text-primary);
            font-weight: 600;
            word-break: break-word;
        }

        /* Ù„Ø§Ú¯ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ */
        .log-section {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-top: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .log-filters {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .log-filter-btn {
            padding: 6px 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
            font-size: 12px;
        }

        .log-filter-btn.active, .log-filter-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .log-container {
            height: 300px;
            overflow-y: auto;
            background: var(--bg-secondary);
            border-radius: var(--radius);
            padding: 16px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            border: 1px solid var(--border);
        }

        .log-entry {
            padding: 10px 0;
            border-bottom: 1px solid var(--border-light);
            word-break: break-word;
            font-size: 12px;
        }

        .log-entry.success { 
            color: var(--success);
            border-left: 3px solid var(--success);
            padding-left: 10px;
        }
        .log-entry.error { 
            color: var(--danger);
            border-left: 3px solid var(--danger);
            padding-left: 10px;
        }
        .log-entry.warning { 
            color: var(--warning);
            border-left: 3px solid var(--warning);
            padding-left: 10px;
        }
        .log-entry.info { 
            color: var(--info);
            border-left: 3px solid var(--info);
            padding-left: 10px;
        }

        .log-time {
            color: var(--text-light);
            font-size: 11px;
            margin-left: 8px;
        }

        /* ØµÙØ­Ù‡â€ŒØ¨Ù†Ø¯ÛŒ */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin: 16px 0;
            flex-wrap: wrap;
        }

        .page-btn {
            padding: 8px 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
            min-width: 40px;
        }

        .page-btn:hover {
            background: var(--bg-hover);
            border-color: var(--border-dark);
        }

        .page-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* ÙÙˆØªØ± */
        .app-footer {
            text-align: center;
            padding: 24px 20px;
            margin-top: 40px;
            border-top: 1px solid var(--border);
            color: var(--text-secondary);
            background: var(--bg-card);
            border-radius: var(--radius-lg);
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 24px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .footer-link {
            color: var(--primary);
            text-decoration: none;
            transition: var(--transition);
            font-weight: 600;
            font-size: 14px;
        }

        .footer-link:hover {
            color: var(--primary-dark);
            text-decoration: underline;
        }

        .copyright {
            font-size: 12px;
            line-height: 1.8;
            color: var(--text-light);
        }

        /* Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ù…ÙˆØ¯Ø§Ù„ */
        .password-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            z-index: 1001;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .password-modal-content {
            background: var(--bg-card);
            padding: 40px;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            max-width: 400px;
            width: 90%;
            text-align: center;
        }

        .password-input {
            width: 100%;
            padding: 16px;
            font-size: 24px;
            text-align: center;
            letter-spacing: 10px;
            border: 3px solid var(--border);
            border-radius: var(--radius);
            margin: 20px 0;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-weight: bold;
        }

        /* Ø¢ÛŒÚ©ÙˆÙ†â€ŒÙ‡Ø§ */
        .icon {
            font-size: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        /* Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ */
        @media (max-width: 1024px) {
            .main-container {
                padding: 16px;
            }
            
            .app-nav {
                flex-direction: column;
                align-items: stretch;
            }
            
            .nav-tabs {
                overflow-x: auto;
                justify-content: flex-start;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 640px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .index-controls {
                flex-direction: column;
            }
            
            .index-btn {
                min-width: 100%;
            }
            
            .process-stats {
                justify-content: center;
            }
            
            .modal-content {
                max-height: 95vh;
                margin: 10px;
            }
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø®Ø§Øµ Ø¨Ø±Ø§ÛŒ Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ */
        .sync-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--bg-secondary);
            border-radius: var(--radius);
            font-size: 12px;
            color: var(--text-secondary);
        }

        .sync-status.syncing {
            color: var(--warning);
        }

        .sync-status.success {
            color: var(--success);
        }

        .sync-status.error {
            color: var(--danger);
        }

        .price-change-summary {
            background: var(--bg-secondary);
            padding: 16px;
            border-radius: var(--radius);
            margin-top: 16px;
            border: 1px solid var(--border);
        }

        .price-change-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-light);
        }

        .price-change-item:last-child {
            border-bottom: none;
        }

        .percent-badge {
            display: inline-block;
            padding: 2px 8px;
            background: var(--primary-light);
            color: white;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
            margin-right: 8px;
        }

        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: var(--text-primary);
            color: white;
            text-align: center;
            border-radius: var(--radius);
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
            font-weight: normal;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .offline-badge {
            display: inline-block;
            padding: 2px 8px;
            background: var(--warning);
            color: white;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }

        .online-badge {
            display: inline-block;
            padding: 2px 8px;
            background: var(--success);
            color: white;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ù‚ÛŒÙ…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ */
        .batch-price-controls {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
            padding: 16px;
            background: var(--bg-secondary);
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }

        .selection-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .selection-info {
            font-size: 12px;
            color: var(--text-secondary);
            padding: 4px 8px;
            background: var(--bg-card);
            border-radius: var(--radius-sm);
        }

        .checkbox-cell {
            width: 40px;
            text-align: center;
        }

        .selection-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .price-summary-card {
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            color: white;
            padding: 16px;
            border-radius: var(--radius);
            margin-top: 12px;
        }

        .price-summary-card h4 {
            margin-bottom: 8px;
            font-size: 14px;
        }

        .price-summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            font-size: 12px;
        }

        .error-message {
            background: var(--danger);
            color: white;
            padding: 12px;
            border-radius: var(--radius);
            margin: 12px 0;
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .retry-button {
            background: var(--warning);
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 11px;
            margin-right: 8px;
        }

        .sync-button-container {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        .main-sync-btn {
            background: linear-gradient(135deg, var(--success), var(--secondary-dark));
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            transition: var(--transition);
        }

        .main-sync-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .collapse-toggle {
            background: none;
            border: none;
            color: var(--primary);
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 0;
        }

        .collapse-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .collapse-content.expanded {
            max-height: 500px;
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ */
        .sync-management-panel {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: var(--radius-lg);
            margin-top: 20px;
            border: 1px solid var(--border);
        }

        .sync-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: var(--bg-card);
            border-radius: var(--radius);
            margin-bottom: 8px;
            border: 1px solid var(--border);
            transition: var(--transition);
        }

        .sync-item:hover {
            background: var(--bg-hover);
        }

        .sync-item-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .sync-item-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .sync-item-details {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            gap: 12px;
        }

        .sync-item-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .sync-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ */
        .column-selector {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .column-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: var(--bg-card);
            border-radius: var(--radius);
            border: 1px solid var(--border);
            cursor: pointer;
            transition: var(--transition);
        }

        .column-option:hover {
            background: var(--bg-hover);
        }

        .column-option.selected {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Ø¨Ø§Ø²Ø¯Ù‡ Ù‚ÛŒÙ…Øª Ù‡Ø± Ú¯Ø±Ù… */
        .yield-filter {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .yield-input {
            width: 100px;
            padding: 8px 12px;
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            color: var(--text-primary);
            font-size: 14px;
            text-align: center;
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ù‡Ø¨ÙˆØ¯ ÛŒØ§ÙØªÙ‡ Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ */
        .sync-progress {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: var(--radius);
            margin-top: 20px;
            border: 1px solid var(--border);
        }

        .sync-progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .sync-progress-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }

        .sync-stat {
            text-align: center;
            padding: 12px;
            background: var(--bg-card);
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }

        .sync-stat .label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .sync-stat .value {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªÛŒØ±Ù‡ Ø¨Ø±Ø§ÛŒ Ø­Ø§Ù„Øª ØªÛŒØ±Ù‡ */
        .dark-theme .price-badge {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
        }

        .dark-theme .yield-badge {
            background: linear-gradient(135deg, var(--secondary-dark), var(--secondary));
        }

        .dark-theme .save-price-btn {
            background: var(--success);
        }

        .dark-theme .save-price-btn:hover {
            background: var(--secondary);
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø­ØµÙˆÙ„ */
        .attributes-table {
            width: 100%;
            border-collapse: collapse;
            margin: 16px 0;
            font-size: 13px;
        }

        .attributes-table th {
            background: var(--bg-secondary);
            padding: 10px 12px;
            text-align: right;
            font-weight: 600;
            border: 1px solid var(--border);
            color: var(--text-primary);
        }

        .attributes-table td {
            padding: 10px 12px;
            border: 1px solid var(--border-light);
            vertical-align: top;
        }

        .attributes-table tr:nth-child(even) {
            background: var(--bg-primary);
        }

        .attributes-table tr:hover {
            background: var(--bg-hover);
        }

        .attribute-name {
            color: var(--primary);
            font-weight: 600;
            min-width: 150px;
        }

        .attribute-values {
            color: var(--text-primary);
            word-break: break-word;
        }

        .attribute-visibility-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            color: var(--text-secondary);
            font-size: 12px;
            cursor: pointer;
        }

        .attribute-filter-section {
            background: var(--bg-secondary);
            padding: 16px;
            border-radius: var(--radius);
            margin-top: 16px;
            border: 1px solid var(--border);
        }

        .attribute-filter-group {
            margin-bottom: 16px;
        }

        .attribute-filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            cursor: pointer;
        }

        .attribute-filter-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
            padding: 8px;
            background: var(--bg-card);
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
        }

        .attribute-filter-option {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            cursor: pointer;
        }

        .attribute-filter-option input[type="checkbox"] {
            width: 14px;
            height: 14px;
        }

        .attribute-stat {
            display: inline-block;
            padding: 2px 6px;
            background: var(--primary-light);
            color: white;
            border-radius: 8px;
            font-size: 10px;
            margin-right: 6px;
        }

        .attribute-search-input {
            width: 100%;
            padding: 8px 12px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-size: 12px;
            margin-bottom: 8px;
        }

        .attribute-search-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .attribute-section-title {
            font-size: 16px;
            color: var(--text-primary);
            margin: 20px 0 12px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--border);
            display: flex;
            align-items: center;
            gap: 8px;
        }
    </style>
</head>
<body class="light-theme">
    <!-- Ø¯Ú©Ù…Ù‡ Ù†ØµØ¨ PWA -->
    <button id="installBtn" class="install-prompt">
        <span class="icon">â¬‡</span> Ù†ØµØ¨ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†
    </button>

    <!-- Ø¯Ú©Ù…Ù‡ ØªØºÛŒÛŒØ± ØªÙ… -->
    <button id="themeToggle" class="theme-toggle" title="ØªØºÛŒÛŒØ± ØªÙ…">
        <span class="icon" id="themeIcon">ğŸŒ™</span>
    </button>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø±Ù…Ø² Ø§ÛŒÙ†Ø¯Ú©Ø³ -->
    <div id="passwordModal" class="password-modal">
        <div class="password-modal-content">
            <h2 style="color: var(--text-primary); margin-bottom: 20px;">ÙˆØ±ÙˆØ¯ Ø±Ù…Ø² Ø§ÛŒÙ†Ø¯Ú©Ø³</h2>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">Ù„Ø·ÙØ§ Ø±Ù…Ø² Û´ Ø±Ù‚Ù…ÛŒ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ ÙØ±Ø¢ÛŒÙ†Ø¯ Ø§ÛŒÙ†Ø¯Ú©Ø³ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</p>
            <input type="password" id="indexPasswordInput" class="password-input" maxlength="4" inputmode="numeric" pattern="[0-9]*" autocomplete="off">
            <div style="display: flex; gap: 12px; margin-top: 24px;">
                <button class="btn btn-primary" onclick="confirmIndexPassword()" style="flex: 1;">ØªØ§ÛŒÛŒØ¯ Ùˆ Ø´Ø±ÙˆØ¹</button>
                <button class="btn" onclick="closePasswordModal()" style="flex: 1; background: var(--bg-secondary); color: var(--text-secondary);">Ù„ØºÙˆ</button>
            </div>
            <p style="color: var(--text-light); font-size: 12px; margin-top: 20px;">Ø±Ù…Ø² Ù¾ÛŒØ´â€ŒÙØ±Ø¶: 4481</p>
        </div>
    </div>

    <div class="main-container">
        <!-- Ù†ÙˆÛŒÚ¯ÛŒØ´Ù† -->
        <nav class="app-nav">
            <div class="nav-brand">
                <span class="icon" style="font-size: 28px; color: var(--primary);">âš¡</span>
                <div>
                    <h1>Radical Indexer Pro v3.5</h1>
                    <p style="color: var(--text-secondary); font-size: 12px; margin-top: 4px;">
                        Ù…Ø¯ÛŒØ±ÛŒØª Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù…Ø­ØµÙˆÙ„Ø§Øª - Ú¯Ø±ÙˆÙ‡ Ù‡Ù†Ø±ÛŒ Ø§Ù‚Ø§Ù‚ÛŒØ§
                        <span id="onlineStatus" class="online-badge">Ø¢Ù†Ù„Ø§ÛŒÙ†</span>
                    </p>
                </div>
            </div>
            
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="switchTab('main')">
                    <span class="icon">ğŸ“¦</span> Ù…Ø­ØµÙˆÙ„Ø§Øª
                </button>
                <button class="nav-tab" onclick="switchTab('sync')">
                    <span class="icon">ğŸ”„</span> Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ
                </button>
                <button class="nav-tab" onclick="switchTab('index')">
                    <span class="icon">âš¡</span> Ø§ÛŒÙ†Ø¯Ú©Ø³
                </button>
                <button class="nav-tab" onclick="switchTab('settings')">
                    <span class="icon">âš™ï¸</span> ØªÙ†Ø¸ÛŒÙ…Ø§Øª
                </button>
                <button class="nav-tab" onclick="switchTab('log')">
                    <span class="icon">ğŸ“‹</span> Ù„Ø§Ú¯ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§
                </button>
                <button class="nav-tab" onclick="switchTab('review')" style="display: inline-flex; align-items: center; gap: 8px;">
                    <span>ğŸ“‹</span>
                    Ø¨Ø§Ø²Ø¨ÛŒÙ†ÛŒ ØªØºÛŒÛŒØ±Ø§Øª
                    <span id="reviewBadge" class="badge" style="background: var(--warning); color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px;">0</span>
                </button>
            </div>
        </nav>

        <!-- Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø§Ø± -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3><span class="icon">ğŸ“¦</span> Ú©Ù„ Ù…Ø­ØµÙˆÙ„Ø§Øª</h3>
                <div class="value" id="totalProducts">0</div>
            </div>
            <div class="stat-card">
                <h3><span class="icon">âš¡</span> Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø´Ø¯Ù‡</h3>
                <div class="value" id="indexedProducts">0</div>
            </div>
            <div class="stat-card">
                <h3><span class="icon">âœï¸</span> ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯Ù‡</h3>
                <div class="value" id="editedProducts">0</div>
            </div>
            <div class="stat-card">
                <h3><span class="icon">ğŸ”„</span> Ø¢Ø®Ø±ÛŒÙ† Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ</h3>
                <div class="value" id="lastSync">---</div>
            </div>
            <div class="stat-card">
                <h3><span class="icon">ğŸ’°</span> Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù‚ÛŒÙ…Øª</h3>
                <div class="value" id="avgPrice">0 ØªÙˆÙ…Ø§Ù†</div>
            </div>
            <div class="stat-card">
                <h3><span class="icon">ğŸ·ï¸</span> ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§</h3>
                <div class="value" id="totalAttributes">0</div>
            </div>
            <div class="stat-card total-price-card">
                <h3><span class="icon">ğŸ’°</span> Ø§Ø±Ø²Ø´ Ú©Ù„ Ù…Ø­ØµÙˆÙ„Ø§Øª</h3>
                <div class="value" id="totalProductsValue">0 ØªÙˆÙ…Ø§Ù†</div>
                <div style="font-size: 12px; color: var(--text-light); margin-top: 8px;">Ø¨Ø± Ø§Ø³Ø§Ø³ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ</div>
            </div>
        </div>

        <!-- ØªØ¨ Ø§ØµÙ„ÛŒ - Ù…Ø­ØµÙˆÙ„Ø§Øª -->
        <div id="mainTab" class="tab-content active">
            <!-- Ø¨Ø®Ø´ ÙÛŒÙ„ØªØ±Ù‡Ø§ Ùˆ Ø¬Ø³ØªØ¬Ùˆ -->
            <div class="filters-bar">
                <button class="collapse-toggle" onclick="toggleFilters()">
                    <span class="icon">ğŸ”</span>
                    Ø¬Ø³ØªØ¬Ùˆ Ùˆ ÙÛŒÙ„ØªØ± Ù¾ÛŒØ´Ø±ÙØªÙ‡
                    <span class="icon" id="filterToggleIcon">â–¼</span>
                </button>
                
                <div class="collapse-content" id="filterContent">
                    <div class="filter-grid" style="margin-top: 20px;">
                        <div>
                            <label class="setting-label">Ø¬Ø³ØªØ¬ÙˆÛŒ Ø³Ø±ÛŒØ¹</label>
                            <input type="text" class="setting-input" id="quickSearch" 
                                   placeholder="Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„ØŒ SKU ÛŒØ§ ØªÙˆØ¶ÛŒØ­Ø§Øª..." oninput="searchProducts()">
                        </div>
                        
                        <div>
                            <label class="setting-label">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</label>
                            <select class="setting-input" id="categoryFilter" onchange="applyFilters()">
                                <option value="">Ù‡Ù…Ù‡ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="setting-label">Ø¨Ø§Ø²Ù‡ Ù‚ÛŒÙ…Øª</label>
                            <div style="display: flex; gap: 8px;">
                                <input type="number" class="setting-input" id="minPrice" placeholder="Ø­Ø¯Ø§Ù‚Ù„" onchange="applyFilters()" style="flex: 1;">
                                <input type="number" class="setting-input" id="maxPrice" placeholder="Ø­Ø¯Ø§Ú©Ø«Ø±" onchange="applyFilters()" style="flex: 1;">
                            </div>
                        </div>
                        
                        <div>
                            <label class="setting-label">Ø¨Ø§Ø²Ø¯Ù‡ Ù‡Ø± Ú¯Ø±Ù…</label>
                            <div class="yield-filter">
                                <input type="number" class="yield-input" id="minYield" placeholder="Ø­Ø¯Ø§Ù‚Ù„" onchange="applyFilters()">
                                <span>ØªØ§</span>
                                <input type="number" class="yield-input" id="maxYield" placeholder="Ø­Ø¯Ø§Ú©Ø«Ø±" onchange="applyFilters()">
                                <span>ØªÙˆÙ…Ø§Ù†</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="filter-row" style="margin-top: 12px;">
                        <label class="filter-checkbox">
                            <input type="checkbox" id="hideNoWeight" checked onchange="applyFilters()">
                            <span>Ø¹Ø¯Ù… Ù†Ù…Ø§ÛŒØ´ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¨ÛŒâ€ŒÙˆØ²Ù†</span>
                        </label>
                        <label class="filter-checkbox">
                            <input type="checkbox" id="hideNoPrice" onchange="applyFilters()">
                            <span>Ø¹Ø¯Ù… Ù†Ù…Ø§ÛŒØ´ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¨ÛŒâ€ŒÙ‚ÛŒÙ…Øª</span>
                        </label>
                        <label class="filter-checkbox">
                            <input type="checkbox" id="hideNoYield" onchange="applyFilters()">
                            <span>Ø¹Ø¯Ù… Ù†Ù…Ø§ÛŒØ´ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¨Ø¯ÙˆÙ† Ø¨Ø§Ø²Ø¯Ù‡</span>
                        </label>
                    </div>

                    <!-- ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ -->
                    <div class="attribute-filter-section" id="attributeFiltersSection">
                        <div class="attribute-filter-header" onclick="toggleAttributeFilters()">
                            <h4 style="color: var(--text-primary); margin: 0; display: flex; align-items: center; gap: 8px;">
                                <span class="icon" id="attributeFilterIcon">ğŸ”½</span>
                                ÙÛŒÙ„ØªØ± Ø¨Ø± Ø§Ø³Ø§Ø³ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø­ØµÙˆÙ„
                                <span class="attribute-stat" id="activeAttributeFilters">0</span>
                            </h4>
                            <button class="action-btn" onclick="clearAttributeFilters(event)" style="font-size: 11px; padding: 4px 8px;">
                                <span class="icon">ğŸ—‘ï¸</span> Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡
                            </button>
                        </div>
                        
                        <div id="attributeFiltersContent" style="display: none; margin-top: 12px;">
                            <input type="text" class="attribute-search-input" id="attributeSearch" 
                                   placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§..." oninput="searchAttributes()">
                            <div id="attributeFiltersContainer" class="filter-grid">
                                <!-- ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ ÙˆÛŒÚ˜Ú¯ÛŒ Ø¨Ù‡ ØµÙˆØ±Øª Ø¯ÛŒÙ†Ø§Ù…ÛŒÚ© Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="applyFilters()" style="margin-top: 20px; width: 100%;">
                        <span class="icon">ğŸ”</span> Ø§Ø¹Ù…Ø§Ù„ ÙÛŒÙ„ØªØ±Ù‡Ø§
                    </button>
                </div>
            </div>

            <!-- Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ù‚ÛŒÙ…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ§ÛŒ (Ø¯Ø±ØµØ¯ÛŒ) -->
            <div class="price-adjustment-panel">
                <h3 style="color: var(--text-primary); margin-bottom: 16px;">ğŸ“Š ØªØºÛŒÛŒØ± Ø¯Ø³ØªÙ‡â€ŒØ§ÛŒ Ù‚ÛŒÙ…Øª (Ø¯Ø±ØµØ¯ÛŒ)</h3>
                
                <div class="filter-grid" style="margin-bottom: 20px;">
                    <div>
                        <label class="setting-label">Ø¯Ø±ØµØ¯ ØªØºÛŒÛŒØ± Ù‚ÛŒÙ…Øª</label>
                        <div style="display: flex; gap: 12px;">
                            <input type="number" class="setting-input" id="priceIncreasePercent" 
                                   placeholder="Ù…Ø«Ù„Ø§Ù‹ 10 Ø¨Ø±Ø§ÛŒ Û±Û°Ùª Ø§ÙØ²Ø§ÛŒØ´" min="-100" max="1000" step="0.1" style="flex: 1;">
                            <button class="btn btn-primary" onclick="applyBatchPriceChange('increase')" style="white-space: nowrap;">
                                <span class="icon">ğŸ“ˆ</span> Ø§ÙØ²Ø§ÛŒØ´
                            </button>
                            <button class="btn btn-warning" onclick="applyBatchPriceChange('decrease')" style="white-space: nowrap;">
                                <span class="icon">ğŸ“‰</span> Ú©Ø§Ù‡Ø´
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <label class="setting-label">Ù†ÙˆØ¹ Ø§Ø¹Ù…Ø§Ù„</label>
                        <div class="selection-controls">
                            <select class="setting-input" id="priceApplyType" style="flex: 1;">
                                <option value="all">ØªÙ…Ø§Ù… Ù…Ø­ØµÙˆÙ„Ø§Øª</option>
                                <option value="filtered">ÙÙ‚Ø· Ù…Ø­ØµÙˆÙ„Ø§Øª ÙÛŒÙ„ØªØ± Ø´Ø¯Ù‡</option>
                                <option value="selected">ÙÙ‚Ø· Ù…Ø­ØµÙˆÙ„Ø§Øª Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡</option>
                            </select>
                            <button class="btn" onclick="selectAllProducts()">
                                <span class="icon">âœ“</span> Ø§Ù†ØªØ®Ø§Ø¨ Ù‡Ù…Ù‡
                            </button>
                            <button class="btn" onclick="deselectAllProducts()">
                                <span class="icon">âœ•</span> Ù„ØºÙˆ Ù‡Ù…Ù‡
                            </button>
                            <span class="selection-info">
                                Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡: <span id="selectedCount">0</span>
                            </span>
                        </div>
                    </div>
                </div>
                
                <div id="batchPriceSummary" class="price-summary-card" style="display: none;">
                    <h4>Ø®Ù„Ø§ØµÙ‡ ØªØºÛŒÛŒØ±Ø§Øª</h4>
                    <div id="batchPriceDetails">
                        <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ø®Ù„Ø§ØµÙ‡ ØªØºÛŒÛŒØ±Ø§Øª -->
                    </div>
                </div>
            </div>

            <!-- ===== Ù¾Ù†Ù„ Ø¬Ø¯ÛŒØ¯: ØªØ¹Ø±ÛŒÙ Ù‚ÛŒÙ…Øª Ù‡Ø± Ú¯Ø±Ù… Ø¯Ø³ØªÙ‡â€ŒØ§ÛŒ ===== -->
            <div class="price-adjustment-panel" style="margin-top: 20px;">
                <h3 style="color: var(--text-primary); margin-bottom: 16px;">ğŸ’° ØªØ¹Ø±ÛŒÙ Ù‚ÛŒÙ…Øª Ù‡Ø± Ú¯Ø±Ù… Ø¯Ø³ØªÙ‡â€ŒØ§ÛŒ</h3>
                <div class="filter-grid">
                    <div>
                        <label class="setting-label">Ù‚ÛŒÙ…Øª Ù‡Ø± Ú¯Ø±Ù… (ØªÙˆÙ…Ø§Ù†)</label>
                        <div style="display: flex; gap: 12px;">
                            <input type="number" class="setting-input" id="targetPricePerGram" 
                                   placeholder="Ù…Ø«Ù„Ø§Ù‹ 50000" min="0" step="1000" style="flex: 1;">
                            <button class="btn btn-primary" onclick="applyBatchPricePerGram()" style="white-space: nowrap;">
                                <span class="icon">ğŸ’°</span> Ø§Ø¹Ù…Ø§Ù„
                            </button>
                        </div>
                    </div>
                    <div>
                        <label class="setting-label">Ù†ÙˆØ¹ Ø§Ø¹Ù…Ø§Ù„</label>
                        <div style="display: flex; gap: 12px; align-items: center;">
                            <select class="setting-input" id="pricePerGramApplyType" style="flex: 1;">
                                <option value="all">ØªÙ…Ø§Ù… Ù…Ø­ØµÙˆÙ„Ø§Øª</option>
                                <option value="filtered">ÙÙ‚Ø· Ù…Ø­ØµÙˆÙ„Ø§Øª ÙÛŒÙ„ØªØ± Ø´Ø¯Ù‡</option>
                                <option value="selected">ÙÙ‚Ø· Ù…Ø­ØµÙˆÙ„Ø§Øª Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡</option>
                            </select>
                            <span class="selection-info">
                                Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ø¯Ø± Ø¬Ø¯ÙˆÙ„: <span id="selectedCountRef">0</span>
                            </span>
                        </div>
                    </div>
                </div>
                <div id="batchPricePerGramSummary" class="price-summary-card" style="display: none;">
                    <h4>Ø®Ù„Ø§ØµÙ‡ ØªØºÛŒÛŒØ±Ø§Øª</h4>
                    <div id="batchPricePerGramDetails"></div>
                </div>
            </div>
            <!-- ===== Ù¾Ø§ÛŒØ§Ù† Ù¾Ù†Ù„ Ø¬Ø¯ÛŒØ¯ ===== -->

            <!-- Ø¯Ú©Ù…Ù‡ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ -->
            <div class="sync-button-container">
                <button class="main-sync-btn" onclick="switchTab('sync')">
                    <span class="icon">ğŸ”„</span> Ù…Ø¯ÛŒØ±ÛŒØª Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ
                    <span id="pendingChangesBadge" style="background: white; color: var(--success); padding: 2px 8px; border-radius: 10px; font-size: 11px; margin-right: 8px;">0</span>
                </button>
            </div>

            <!-- Ø¬Ø¯ÙˆÙ„ Ù…Ø­ØµÙˆÙ„Ø§Øª -->
            <div class="products-table-container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div>
                        <span id="resultsCount">0</span> Ù…Ø­ØµÙˆÙ„ ÛŒØ§ÙØª Ø´Ø¯ | 
                        <span id="editedCount">0</span> ÙˆÛŒØ±Ø§ÛŒØ´ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ |
                        <span id="attributeMatchCount">0</span> Ù…Ø­ØµÙˆÙ„ Ù…Ø·Ø§Ø¨Ù‚ ÙÛŒÙ„ØªØ± ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§
                    </div>
                    <div class="sync-status" id="syncStatus">
                        <span class="icon">ğŸ”„</span>
                        <span>Ø¢Ø®Ø±ÛŒÙ† Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ: ---</span>
                    </div>
                </div>

                <!-- ØµÙØ­Ù‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ø§Ù„Ø§ -->
                <div class="pagination" id="paginationTop"></div>
                
                <div class="table-wrapper">
                    <table>
                        <thead class="sticky-header">
                            <tr id="tableHeader">
                                <!-- Ù‡Ø¯Ø± Ø¬Ø¯ÙˆÙ„ Ø¨Ù‡ ØµÙˆØ±Øª Ø¯ÛŒÙ†Ø§Ù…ÛŒÚ© Ø³Ø§Ø®ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                            </tr>
                        </thead>
                        <tbody id="resultsTable">
                            <!-- Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª -->
                        </tbody>
                    </table>
                </div>
                
                <!-- ØµÙØ­Ù‡â€ŒØ¨Ù†Ø¯ÛŒ Ù¾Ø§ÛŒÛŒÙ† -->
                <div class="pagination" id="paginationBottom"></div>
            </div>
        </div>

        <!-- ØªØ¨ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ -->
        <div id="syncTab" class="tab-content">
            <div class="settings-section">
                <h2 class="section-title"><span class="icon">ğŸ”„</span> Ù…Ø¯ÛŒØ±ÛŒØª Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ Ø³Ø§ÛŒØª</h2>
                
                <div class="sync-management-panel">
<div style="display: flex; gap: 8px;">
    <button class="btn btn-primary" onclick="syncSelectedChanges()">
        <span class="icon">ğŸ”„</span> Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡â€ŒÙ‡Ø§
    </button>
    <button class="btn btn-success" onclick="syncAllPendingChanges()">
        <span class="icon">âš¡</span> Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ù‡Ù…Ù‡
    </button>
    <button class="btn btn-danger" onclick="deleteAllSyncItems()">
        <span class="icon">ğŸ—‘ï¸</span> Ø­Ø°Ù Ù‡Ù…Ù‡
    </button>
</div>
                    
                    <div id="syncItemsContainer">
                        <!-- Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¨Ù‡ ØµÙˆØ±Øª Ø¯ÛŒÙ†Ø§Ù…ÛŒÚ© -->
                    </div>
                    
                    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <label class="filter-checkbox">
                                    <input type="checkbox" id="selectAllSync" onchange="toggleSelectAllSyncItems()">
                                    <span>Ø§Ù†ØªØ®Ø§Ø¨ Ù‡Ù…Ù‡</span>
                                </label>
                            </div>
                            <div style="color: var(--text-secondary); font-size: 12px;">
                                <span id="selectedSyncCount">0</span> Ø¢ÛŒØªÙ… Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ø§Ø² 
                                <span id="totalSyncCount">0</span> Ø¢ÛŒØªÙ…
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ù¾ÛŒØ´Ø±ÙØª Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ -->
                <div class="sync-progress" id="syncProgressSection" style="display: none;">
                    <h3 style="color: var(--text-primary); margin-bottom: 16px;">Ù¾ÛŒØ´Ø±ÙØª Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ</h3>
                    
                    <div class="progress-bar-container">
                        <div class="sync-progress-info">
                            <span>Ø¯Ø± Ø­Ø§Ù„ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ...</span>
                            <span id="syncProgressPercent">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="syncProgressFill" style="width: 0%;"></div>
                        </div>
                    </div>
                    
                    <div class="sync-progress-stats">
                        <div class="sync-stat">
                            <div class="label">Ù…ÙˆÙÙ‚</div>
                            <div class="value" id="syncSuccessCount">0</div>
                        </div>
                        <div class="sync-stat">
                            <div class="label">Ù†Ø§Ù…ÙˆÙÙ‚</div>
                            <div class="value" id="syncErrorCount">0</div>
                        </div>
                        <div class="sync-stat">
                            <div class="label">Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù…</div>
                            <div class="value" id="syncPendingCount">0</div>
                        </div>
                        <div class="sync-stat">
                            <div class="label">Ú©Ù„</div>
                            <div class="value" id="syncTotalCount">0</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; display: flex; gap: 8px;">
                        <button class="btn btn-warning" onclick="pauseSync()" id="pauseSyncBtn" style="display: none;">
                            <span class="icon">â¸ï¸</span> ØªÙˆÙ‚Ù Ù…ÙˆÙ‚Øª
                        </button>
                        <button class="btn btn-danger" onclick="stopSync()">
                            <span class="icon">â¹ï¸</span> ØªÙˆÙ‚Ù Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ
                        </button>
                    </div>
                </div>

                <!-- Ù„Ø§Ú¯ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ -->
                <div class="log-section" style="margin-top: 24px;">
                    <div class="log-header">
                        <h3 style="color: var(--text-primary);">Ù„Ø§Ú¯ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ</h3>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <button class="action-btn" onclick="clearSyncLogs()">
                                <span class="icon">ğŸ—‘ï¸</span> Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†
                            </button>
                        </div>
                    </div>
                    
                    <div class="log-container" id="syncLogContainer">
                        <!-- Ù„Ø§Ú¯ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ -->
                    </div>
                </div>
            </div>
        </div>

        <!-- ØªØ¨ Ø§ÛŒÙ†Ø¯Ú©Ø³ -->
        <div id="indexTab" class="tab-content">
            <div class="settings-section">
                <h2 class="section-title"><span class="icon">âš¡</span> Ù…Ø¯ÛŒØ±ÛŒØª Ø§ÛŒÙ†Ø¯Ú©Ø³ Ù‡ÙˆØ´Ù…Ù†Ø¯</h2>
                
                <div class="index-process">
                    <div class="process-header">
                        <h3 style="color: var(--primary);">ÙØ±Ø¢ÛŒÙ†Ø¯ Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø²Ù†Ø¯Ù‡</h3>
                        <div class="process-stats">
                            <div class="process-stat">
                                <div class="label">ØµÙØ­Ù‡ Ø¬Ø§Ø±ÛŒ</div>
                                <div class="value" id="currentPageIndex">0</div>
                            </div>
                            <div class="process-stat">
                                <div class="label">Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯Ù‡</div>
                                <div class="value" id="fetchedProducts">0</div>
                            </div>
                            <div class="process-stat">
                                <div class="label">ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§</div>
                                <div class="value" id="fetchedAttributes">0</div>
                            </div>
                            <div class="process-stat">
                                <div class="label">Ø²Ù…Ø§Ù† Ø³Ù¾Ø±ÛŒ Ø´Ø¯Ù‡</div>
                                <div class="value" id="elapsedTime">00:00</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="progress-bar-container">
                        <div class="progress-info">
                            <span>Ù¾ÛŒØ´Ø±ÙØª Ø§ÛŒÙ†Ø¯Ú©Ø³</span>
                            <span id="progressText">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                    </div>
                    
                    <div class="index-controls">
                        <button class="index-btn btn-primary" onclick="showPasswordModal()" id="startIndexBtn">
                            <span class="icon">â–¶ï¸</span> Ø´Ø±ÙˆØ¹ Ø§ÛŒÙ†Ø¯Ú©Ø³
                        </button>
                        <button class="index-btn btn-warning" onclick="pauseIndexing()" id="pauseBtn" disabled>
                            <span class="icon">â¸ï¸</span> ØªÙˆÙ‚Ù Ù…ÙˆÙ‚Øª
                        </button>
                        <button class="index-btn btn-success" onclick="continueIndexing()" id="continueBtn" style="display: none;">
                            <span class="icon">â–¶ï¸</span> Ø§Ø¯Ø§Ù…Ù‡ Ø§ÛŒÙ†Ø¯Ú©Ø³
                        </button>
                        <button class="index-btn btn-danger" onclick="resetIndexing()">
                            <span class="icon">ğŸ—‘ï¸</span> Ø±ÛŒØ³Øª Ø§ÛŒÙ†Ø¯Ú©Ø³
                        </button>
                    </div>

                    <!-- Ù„Ø§Ú¯ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ†Ø¯Ú©Ø³ -->
                    <div class="log-section" style="margin-top: 24px;">
                        <div class="log-header">
                            <h3 style="color: var(--text-primary);">Ù„Ø§Ú¯ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ†Ø¯Ú©Ø³</h3>
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <span style="color: var(--text-secondary); font-size: 12px;">
                                    <span id="indexLogCount">0</span> Ø±Ú©ÙˆØ±Ø¯
                                </span>
                                <button class="action-btn" onclick="clearIndexLogs()">
                                    <span class="icon">ğŸ—‘ï¸</span> Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†
                                </button>
                            </div>
                        </div>
                        
                        <div class="log-container" id="indexLogContainer">
                            <!-- Ù„Ø§Ú¯ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ†Ø¯Ú©Ø³ -->
                        </div>
                    </div>
                </div>
                
                <!-- ÙˆØ¶Ø¹ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø§ÛŒÙ†Ø¯Ú©Ø³ -->
                <div style="margin-top: 24px; background: var(--bg-secondary); padding: 20px; border-radius: var(--radius);">
                    <h3 style="color: var(--text-primary); margin-bottom: 12px;">ÙˆØ¶Ø¹ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø§ÛŒÙ†Ø¯Ú©Ø³</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                        <div>
                            <div class="setting-label">Ø¢Ø®Ø±ÛŒÙ† ØµÙØ­Ù‡ Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø´Ø¯Ù‡</div>
                            <div id="lastIndexedPage">---</div>
                        </div>
                        <div>
                            <div class="setting-label">ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡</div>
                            <div id="totalSavedAttributes">0</div>
                        </div>
                        <div>
                            <div class="setting-label">ÙˆØ¶Ø¹ÛŒØª Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡</div>
                            <div id="dbStatus" style="color: var(--success); font-weight: 600;">ÙØ¹Ø§Ù„</div>
                        </div>
                    </div>
                </div>

                <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø¯Ù‡ -->
                <div style="display: flex; gap: 12px; margin-top: 24px; flex-wrap: wrap;">
                    <button class="btn" onclick="exportIndexedData()" style="flex: 1; background: var(--bg-secondary); color: var(--text-secondary);">
                        <span class="icon">ğŸ“¤</span> Ø®Ø±ÙˆØ¬ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                    </button>
                    <button class="btn" onclick="importIndexedData()" style="flex: 1; background: var(--bg-secondary); color: var(--text-secondary);">
                        <span class="icon">ğŸ“¥</span> ÙˆØ±ÙˆØ¯ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                    </button>
                    <button class="btn btn-danger" onclick="clearAllData()" style="flex: 1;">
                        <span class="icon">ğŸ—‘ï¸</span> Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                    </button>
                </div>
            </div>
        </div>

        <!-- ØªØ¨ ØªÙ†Ø¸ÛŒÙ…Ø§Øª -->
        <div id="settingsTab" class="tab-content">
            <div class="settings-section">
                <h2 class="section-title"><span class="icon">âš™ï¸</span> ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ØªØµØ§Ù„ Ùˆ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ</h2>
                
                <div class="settings-grid">
                    <div class="setting-group">
                        <label class="setting-label">Ø¢Ø¯Ø±Ø³ Ø³Ø§ÛŒØª ÙˆÙˆÚ©Ø§Ù…Ø±Ø³</label>
                        <input type="url" class="setting-input" id="siteUrl" 
                               value="https://mashahir.jewelry" placeholder="https://example.com">
                        
                        <label class="setting-label" style="margin-top: 16px;">Ú©Ù„ÛŒØ¯ API (Consumer Key)</label>
                        <input type="password" class="setting-input" id="consumerKey" 
                               value="ck_d08e1bd6c4a86e44d2d72028053dc0d7f42b141e">
                        
                        <label class="setting-label" style="margin-top: 16px;">Ú©Ù„ÛŒØ¯ Ù…Ø®ÙÛŒ (Consumer Secret)</label>
                        <input type="password" class="setting-input" id="consumerSecret" 
                               value="cs_f4bb36598eaeb9187d894d8b85677667cb0fae65">
                        
                        <button class="btn btn-primary" onclick="testConnection()" style="margin-top: 20px; width: 100%;">
                            <span class="icon">ğŸ”Œ</span> ØªØ³Øª Ø§ØªØµØ§Ù„
                        </button>
                    </div>
                    
                    <div class="setting-group">
                        <label class="setting-label">ØªØ¹Ø¯Ø§Ø¯ Ù…Ø­ØµÙˆÙ„ Ø¯Ø± Ù‡Ø± ØµÙØ­Ù‡</label>
                        <input type="number" class="setting-input" id="perPage" value="50" min="10" max="100">
                        
                        <label class="setting-label" style="margin-top: 16px;">ØªØ¹Ø¯Ø§Ø¯ Ø±Ø¯ÛŒÙ Ø¯Ø± Ø¬Ø¯ÙˆÙ„</label>
                        <input type="number" class="setting-input" id="rowsPerPage" value="15" min="5" max="50">
                        
                        <label class="setting-label" style="margin-top: 16px;">Ø±Ù…Ø² Ø§ÛŒÙ†Ø¯Ú©Ø³ Ù¾ÛŒØ´â€ŒÙØ±Ø¶</label>
                        <input type="password" class="setting-input" id="defaultIndexPassword" 
                               value="4481" maxlength="4" readonly style="background: var(--bg-primary);">
                        
                        <button class="btn btn-success" onclick="saveSettings()" style="margin-top: 20px; width: 100%;">
                            <span class="icon">ğŸ’¾</span> Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
                        </button>
                    </div>
                </div>
                
                <!-- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù†Ù…Ø§ÛŒØ´ Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ -->
                <div style="margin-top: 32px;">
                    <h2 class="section-title"><span class="icon">ğŸ‘ï¸</span> ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù†Ù…Ø§ÛŒØ´ Ø¬Ø¯ÙˆÙ„</h2>
                    
                    <div style="background: var(--bg-secondary); padding: 24px; border-radius: var(--radius-lg);">
                        <p style="color: var(--text-secondary); margin-bottom: 16px;">
                            Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¯Ø± Ø¬Ø¯ÙˆÙ„ Ù…Ø­ØµÙˆÙ„Ø§Øª Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆÙ†Ø¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:
                        </p>
                        
                        <div class="column-selector" id="columnSelector">
                            <!-- Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø¯ÛŒÙ†Ø§Ù…ÛŒÚ© Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                        </div>
                        
                        <button class="btn btn-primary" onclick="saveColumnSettings()" style="margin-top: 20px;">
                            <span class="icon">ğŸ’¾</span> Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù†Ù…Ø§ÛŒØ´
                        </button>
                    </div>
                </div>

                <!-- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù†Ù…Ø§ÛŒØ´ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø­ØµÙˆÙ„ -->
                <div style="margin-top: 32px;">
                    <h2 class="section-title"><span class="icon">ğŸ·ï¸</span> ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù†Ù…Ø§ÛŒØ´ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø­ØµÙˆÙ„</h2>
                    
                    <div style="background: var(--bg-secondary); padding: 24px; border-radius: var(--radius-lg);">
                        <div class="filter-row" style="margin-bottom: 20px;">
                            <label class="filter-checkbox">
                                <input type="checkbox" id="showAttributesInPopup" checked>
                                <span>Ù†Ù…Ø§ÛŒØ´ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ Ø¯Ø± Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ù…Ø­ØµÙˆÙ„</span>
                            </label>
                            <label class="filter-checkbox">
                                <input type="checkbox" id="showAttributesInFilters" checked>
                                <span>Ù†Ù…Ø§ÛŒØ´ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ Ø¯Ø± Ø¬Ø³ØªØ¬ÙˆÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡</span>
                            </label>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <label class="setting-label">Ø­Ø¯Ø§Ú©Ø«Ø± ØªØ¹Ø¯Ø§Ø¯ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ÛŒ Ø¯Ø± Ù¾Ø§Ù¾â€ŒØ¢Ù¾</label>
                            <input type="number" class="setting-input" id="maxAttributesDisplay" value="15" min="1" max="50">
                        </div>

                        <div style="margin-top: 20px;">
                            <label class="setting-label">Ø­Ø¯Ø§Ú©Ø«Ø± ØªØ¹Ø¯Ø§Ø¯ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ±</label>
                            <input type="number" class="setting-input" id="maxAttributesForFilter" value="20" min="1" max="100">
                        </div>

                        <div style="margin-top: 20px;">
                            <label class="setting-label">Ø³Ø·Ø­ Ø¯Ù‚Øª Ø¬Ø³ØªØ¬ÙˆÛŒ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§</label>
                            <select class="setting-input" id="attributeSearchPrecision">
                                <option value="exact">Ø¯Ù‚ÛŒÙ‚</option>
                                <option value="partial">Ø¬Ø²Ø¦ÛŒ</option>
                                <option value="fuzzy">ÙØ§Ø²ÛŒ</option>
                            </select>
                        </div>
                        
                        <button class="btn btn-primary" onclick="saveAttributeSettings()" style="margin-top: 20px;">
                            <span class="icon">ğŸ’¾</span> Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§
                        </button>
                    </div>
                </div>

                <!-- Ù…Ø¯ÛŒØ±ÛŒØª ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ± -->
                <div style="margin-top: 32px;">
                    <h2 class="section-title"><span class="icon">ğŸ”</span> Ù…Ø¯ÛŒØ±ÛŒØª ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ±</h2>
                    
                    <div style="background: var(--bg-secondary); padding: 24px; border-radius: var(--radius-lg);">
                        <div style="margin-bottom: 16px; display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: var(--text-secondary);">
                                ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¯Ø± ÙÛŒÙ„ØªØ±Ù‡Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆÙ†Ø¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:
                            </span>
                            <button class="btn btn-success" onclick="refreshAttributesList()" style="font-size: 12px; padding: 6px 12px;">
                                <span class="icon">ğŸ”„</span> Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù„ÛŒØ³Øª
                            </button>
                        </div>
                        
                        <div id="attributesListContainer" style="max-height: 300px; overflow-y: auto; padding: 8px; background: var(--bg-card); border-radius: var(--radius); border: 1px solid var(--border);">
                            <!-- Ù„ÛŒØ³Øª ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø¯ÛŒÙ†Ø§Ù…ÛŒÚ© -->
                            <div style="text-align: center; padding: 20px; color: var(--text-secondary);">
                                <span class="icon">ğŸ”„</span>
                                <p>Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù„ÛŒØ³Øª ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ØŒ Ø§Ø¨ØªØ¯Ø§ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø±Ø§ Ø§ÛŒÙ†Ø¯Ú©Ø³ Ú©Ù†ÛŒØ¯</p>
                            </div>
                        </div>
                        
                        <div style="margin-top: 16px; display: flex; gap: 8px;">
                            <button class="btn btn-primary" onclick="selectAllAttributesForFilter()">
                                <span class="icon">âœ“</span> Ø§Ù†ØªØ®Ø§Ø¨ Ù‡Ù…Ù‡
                            </button>
                            <button class="btn" onclick="deselectAllAttributesForFilter()">
                                <span class="icon">âœ•</span> Ù„ØºÙˆ Ù‡Ù…Ù‡
                            </button>
                            <button class="btn btn-success" onclick="saveSelectedAttributes()" style="flex: 1;">
                                <span class="icon">ğŸ’¾</span> Ø°Ø®ÛŒØ±Ù‡ Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Ø¢Ù…Ø§Ø± Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ -->
                <div style="margin-top: 32px;">
                    <h2 class="section-title"><span class="icon">ğŸ“Š</span> Ø¢Ù…Ø§Ø± Ùˆ ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒØ³ØªÙ…</h2>
                    
                    <div class="settings-grid">
                        <div class="setting-group">
                            <div class="process-stat">
                                <div class="label">ØªØ¹Ø¯Ø§Ø¯ Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§ÛŒ Ø§ÛŒÙ†Ø¯Ú©Ø³</div>
                                <div class="value" id="dbRecords">0</div>
                            </div>
                        </div>
                        <div class="setting-group">
                            <div class="process-stat">
                                <div class="label">Ø­Ø¬Ù… Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡</div>
                                <div class="value" id="dbSize">0 KB</div>
                            </div>
                        </div>
                        <div class="setting-group">
                            <div class="process-stat">
                                <div class="label">Ø¢Ø®Ø±ÛŒÙ† Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ</div>
                                <div class="value" id="dbLastUpdate">---</div>
                            </div>
                        </div>
                        <div class="setting-group">
                            <h4 style="color: var(--text-primary); margin-bottom: 16px;">ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù†Ù…Ø§ÛŒØ´ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§</h4>
                            <div id="attributeSettingsList">
                                <!-- ØªÙ†Ø¸ÛŒÙ…Ø§Øª ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ -->
                            </div>
                            <button class="btn btn-success" onclick="saveAttributeSettings()" style="margin-top: 20px; width: 100%;">
                                <span class="icon">ğŸ’¾</span> Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
                            </button>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 12px; margin-top: 24px; flex-wrap: wrap;">
                        <button class="btn" onclick="optimizeDatabase()" style="flex: 1; background: var(--bg-secondary); color: var(--text-secondary);">
                            <span class="icon">ğŸ§¹</span> Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡
                        </button>
                        <button class="btn" onclick="backupDatabase()" style="flex: 1; background: var(--bg-secondary); color: var(--text-secondary);">
                            <span class="icon">ğŸ’¾</span> Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ
                        </button>
                        <button class="btn" onclick="restoreDatabase()" style="flex: 1; background: var(--bg-secondary); color: var(--text-secondary);">
                            <span class="icon">ğŸ”„</span> Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ØªØ¨ Ù„Ø§Ú¯ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ -->
        <div id="logTab" class="tab-content">
            <div class="settings-section">
                <h2 class="section-title"><span class="icon">ğŸ“‹</span> ØªØ§Ø±ÛŒØ®Ú†Ù‡ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ Ùˆ Ú¯Ø²Ø§Ø±Ø´Ø§Øª</h2>
                
                <div class="log-header">
                    <div class="log-filters">
                        <button class="log-filter-btn active" onclick="filterAllLogs('all')">Ù‡Ù…Ù‡</button>
                        <button class="log-filter-btn" onclick="filterAllLogs('success')">Ù…ÙˆÙÙ‚</button>
                        <button class="log-filter-btn" onclick="filterAllLogs('error')">Ø®Ø·Ø§</button>
                        <button class="log-filter-btn" onclick="filterAllLogs('warning')">Ù‡Ø´Ø¯Ø§Ø±</button>
                        <button class="log-filter-btn" onclick="filterAllLogs('info')">Ø§Ø·Ù„Ø§Ø¹Ø§Øª</button>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="color: var(--text-secondary); font-size: 12px;">
                            <span id="logCount">0</span> Ø±Ú©ÙˆØ±Ø¯
                        </span>
                        <button class="action-btn" onclick="exportAllLogs()">
                            <span class="icon">ğŸ“¤</span> Ø®Ø±ÙˆØ¬ÛŒ CSV
                        </button>
                        <button class="action-btn" onclick="clearAllLogs()">
                            <span class="icon">ğŸ—‘ï¸</span> Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†
                        </button>
                    </div>
                </div>
                
                <div class="log-container" id="activityLog">
                    <!-- Ù„Ø§Ú¯ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ -->
                </div>
            </div>
        </div>
        <!-- ØªØ¨ Ø¨Ø§Ø²Ø¨ÛŒÙ†ÛŒ ØªØºÛŒÛŒØ±Ø§Øª -->
        <div id="reviewTab" class="tab-content">
            <div class="settings-section">
                <h2 class="section-title">ğŸ“‹ Ø¨Ø§Ø²Ø¨ÛŒÙ†ÛŒ Ùˆ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ ØªØºÛŒÛŒØ±Ø§Øª Ù‚ÛŒÙ…Øª</h2>
                
                <!-- Ø®Ù„Ø§ØµÙ‡ Ø¢Ù…Ø§Ø± -->
                <div class="review-summary">
                    <div class="review-card success">
                        <div class="count" id="readyToSync">0</div>
                        <div>Ø¢Ù…Ø§Ø¯Ù‡ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ</div>
                    </div>
                    <div class="review-card warning">
                        <div class="count" id="needReview">0</div>
                        <div>Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø±Ø±Ø³ÛŒ</div>
                    </div>
                    <div class="review-card danger">
                        <div class="count" id="failedSync">0</div>
                        <div>Ù†Ø§Ù…ÙˆÙÙ‚</div>
                    </div>
                    <div class="review-card">
                        <div class="count" id="totalChanges">0</div>
                        <div>Ú©Ù„ ØªØºÛŒÛŒØ±Ø§Øª</div>
                    </div>
                </div>

                <!-- ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ Ø¨Ø§Ø²Ø¨ÛŒÙ†ÛŒ -->
                <div class="filters-bar">
                    <div class="filter-tags" id="reviewFilterTags">
                        <!-- ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ ÙØ¹Ø§Ù„ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button class="btn" onclick="selectAllChanges()">
                            <span>âœ“</span> Ø§Ù†ØªØ®Ø§Ø¨ Ù‡Ù…Ù‡
                        </button>
                        <button class="btn" onclick="deselectAllChanges()">
                            <span>âœ•</span> Ù„ØºÙˆ Ù‡Ù…Ù‡
                        </button>
                        <span class="selection-info">
                            Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡: <span id="selectedChangesCount">0</span>
                        </span>
                    </div>
                </div>

                <!-- Ù„ÛŒØ³Øª ØªØºÛŒÛŒØ±Ø§Øª -->
                <div id="changesList" style="margin-top: 20px;">
                    <!-- ØªØºÛŒÛŒØ±Ø§Øª Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                </div>

                <!-- Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ø¯Ø³ØªÙ‡â€ŒØ§ÛŒ -->
                <div style="display: flex; justify-content: space-between; margin-top: 30px; padding-top: 20px; border-top: 2px solid var(--border);">
                    <div>
                        <button class="btn btn-danger" onclick="discardSelectedChanges()">
                            <span>ğŸ—‘ï¸</span> Ø­Ø°Ù Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§
                        </button>
                    </div>
                    <div>
                        <button class="btn btn-success" onclick="syncSelectedToSite()">
                            <span>ğŸ”„</span> Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§ Ø¨Ø§ Ø³Ø§ÛŒØª
                        </button>
                    </div>
                </div>

                <!-- Ø¬Ø²Ø¦ÛŒØ§Øª Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ -->
                <div class="log-section" style="margin-top: 30px;">
                    <h3 style="color: var(--text-primary); margin-bottom: 15px;">Ø¬Ø²Ø¦ÛŒØ§Øª Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ</h3>
                    <div class="log-container" id="syncDetails">
                        <!-- Ø¬Ø²Ø¦ÛŒØ§Øª Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ -->
                    </div>
                </div>
            </div>
        </div>
        <!-- Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ù…Ø­ØµÙˆÙ„ -->
        <div class="modal-overlay" id="productModal" onclick="closeModal(event)">
            <div class="modal-content" onclick="event.stopPropagation()">
                <div class="modal-header">
                    <h2 id="modalTitle">Ø¬Ø²Ø¦ÛŒØ§Øª Ù…Ø­ØµÙˆÙ„</h2>
                    <button class="close-modal" onclick="closeModal()">Ã—</button>
                </div>
                <div class="modal-body" id="modalContent">
                    <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ù¾Ø§Ù¾â€ŒØ¢Ù¾ -->
                </div>
            </div>
        </div>

        <!-- Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ -->
        <div id="errorMessage" class="error-message" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span id="errorText"></span>
                <button class="retry-button" onclick="retryLastOperation()">ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯</button>
            </div>
        </div>

        <!-- ÙÙˆØªØ± -->
        <footer class="app-footer">
            <div class="footer-links">
                <a href="https://ncnn.ir" target="_blank" class="footer-link">
                    <span class="icon">ğŸ¨</span> Ú¯Ø±ÙˆÙ‡ Ù‡Ù†Ø±ÛŒ Ø§Ù‚Ø§Ù‚ÛŒØ§
                </a>
                <a href="#" class="footer-link" onclick="showInstallPrompt()">
                    <span class="icon">â¬‡</span> Ù†ØµØ¨ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†
                </a>
                <a href="#" class="footer-link" onclick="showHelp()">
                    <span class="icon">â“</span> Ø±Ø§Ù‡Ù†Ù…Ø§
                </a>
                <a href="#" class="footer-link" onclick="switchTab('settings')">
                    <span class="icon">âš™ï¸</span> Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ
                </a>
            </div>
            
            <div class="copyright">
                <p>ØªÙ†Ù‡Ø§ Ú©Ø§Ø±ÛŒ Ø§Ø² <strong>Ú¯Ø±ÙˆÙ‡ Ù‡Ù†Ø±ÛŒ Ø§Ù‚Ø§Ù‚ÛŒØ§</strong> | Û±Û³Û¸Û¸-Û±Û´Û°Û´</p>
                <p>Exclusive work of <strong>Aghaghia Art Group</strong> | 2009-2025</p>
                <p style="margin-top: 12px; font-size: 11px; color: var(--text-light);">
                    Radical Indexer Pro v3.5 - Ù‚Ø§Ø¨Ù„ÛŒØª Ù…Ø¯ÛŒØ±ÛŒØª ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø­ØµÙˆÙ„ Ùˆ ÙÛŒÙ„ØªØ± Ù¾ÛŒØ´Ø±ÙØªÙ‡
                </p>
            </div>
        </footer>
    </div>

    <!-- JavaScript Ø§ØµÙ„ÛŒ -->
    <script>
        // =========== Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ ===========
        const INDEX_PASSWORD = "4481";
        let appConfig = {
            siteUrl: "https://mashahir.jewelry",
            consumerKey: "ck_d08e1bd6c4a86e44d2d72028053dc0d7f42b141e",
            consumerSecret: "cs_f4bb36598eaeb9187d894d8b85677667cb0fae65",
            perPage: 50,
            rowsPerPage: 15,
            hideNoWeight: true,
            autoSync: true,
            lastSyncTime: null,
            theme: 'light',
            visibleColumns: {
                id: true,
                name: true,
                date_modified: true,
                weight: true,
                price_per_gram: true,
                price: true,
                yield_per_gram: true,
                new_price: true,
                actions: true
            },
            // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§
            showAttributesInPopup: true,
            showAttributesInFilters: true,
            maxAttributesDisplay: 15,
            maxAttributesForFilter: 20,
            attributeSearchPrecision: 'exact',
            selectedAttributesForFilter: [],
            attributeFilters: {}
        };

        // =========== Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø³Ø±Ø§Ø³Ø±ÛŒ ===========
        let db;
        let isIndexing = false;
        let isPaused = false;
        let isSyncing = false;
        let isSyncPaused = false;
        let indexStartTime = 0;
        let syncStartTime = 0;
        let timerInterval;
        let syncTimerInterval;
        let currentPage = 1;
        let filteredProducts = [];
        let allProducts = [];
        let sortColumn = 'date_modified';
        let sortDirection = 'desc';
        let priceEdits = new Map();
        let indexedPages = new Set();
        let totalProductsCount = 0;
        let fetchedProductsCount = 0;
        let totalAttributesCount = 0;
        let selectedProducts = new Set();
        let selectedSyncItems = new Set();
        let pendingSyncCount = 0;
        let isOnline = navigator.onLine;
        let dbInitialized = false;
        let lastOperation = null;
        let lastOperationData = null;
        let syncQueue = [];
        let columnDefinitions = {
            id: { key: 'id', label: 'Ø´Ù†Ø§Ø³Ù‡', sortable: true },
            name: { key: 'name', label: 'Ø¹Ù†ÙˆØ§Ù† Ù…Ø­ØµÙˆÙ„', sortable: true },
            date_modified: { key: 'date_modified', label: 'Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ', sortable: true },
            weight: { key: 'weight', label: 'ÙˆØ²Ù† (Ú¯Ø±Ù…)', sortable: true },
            price_per_gram: { key: 'price_per_gram', label: 'Ù‚ÛŒÙ…Øª Ù‡Ø± Ú¯Ø±Ù…', sortable: true },
            price: { key: 'price', label: 'Ù‚ÛŒÙ…Øª Ú©Ù„', sortable: true },
            yield_per_gram: { key: 'yield_per_gram', label: 'Ø¨Ø§Ø²Ø¯Ù‡ Ù‡Ø± Ú¯Ø±Ù…', sortable: true },
            new_price: { key: 'new_price', label: 'Ù‚ÛŒÙ…Øª Ø¬Ø¯ÛŒØ¯' },
            actions: { key: 'actions', label: 'Ø¹Ù…Ù„ÛŒØ§Øª' }
        };

        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§
        let allAttributes = new Map(); // Map<attributeName, Set<values>>
        let attributeFilters = new Map(); // Map<attributeName, Set<selectedValues>>
        let activeAttributeFilterCount = 0;

        // =========== Ù…Ø¯ÛŒØ±ÛŒØª ØªÙ… ===========
        function initTheme() {
            const savedTheme = localStorage.getItem('radical_indexer_theme') || 'light';
            appConfig.theme = savedTheme;
            applyTheme(savedTheme);
        }

        function applyTheme(theme) {
            document.body.className = theme + '-theme';
            document.getElementById('themeIcon').textContent = theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
            localStorage.setItem('radical_indexer_theme', theme);
        }

        function toggleTheme() {
            const newTheme = appConfig.theme === 'light' ? 'dark' : 'light';
            appConfig.theme = newTheme;
            applyTheme(newTheme);
            log(`ØªÙ… ${newTheme === 'dark' ? 'ØªÛŒØ±Ù‡' : 'Ø±ÙˆØ´Ù†'} ÙØ¹Ø§Ù„ Ø´Ø¯`, 'info');
        }

        // =========== Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ IndexedDB ===========
        const DB_NAME = 'radical_indexer_pro_v5';
        const DB_VERSION = 6;

        async function initDatabase() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);

                request.onupgradeneeded = function(event) {
                    const db = event.target.result;
                    
                    // Ø§ÛŒØ¬Ø§Ø¯ Ø§Ø³ØªÙˆØ±Ù‡Ø§
                    if (!db.objectStoreNames.contains('products')) {
                        const store = db.createObjectStore('products', { keyPath: 'id' });
                        store.createIndex('name', 'name', { unique: false });
                        store.createIndex('category', 'category', { unique: false });
                        store.createIndex('price', 'price', { unique: false });
                        store.createIndex('date_modified', 'date_modified', { unique: false });
                        store.createIndex('weight', 'weight', { unique: false });
                        store.createIndex('price_per_gram', 'price_per_gram', { unique: false });
                        store.createIndex('last_indexed', 'last_indexed', { unique: false });
                    }
                    
                    if (!db.objectStoreNames.contains('price_edits')) {
                        const editsStore = db.createObjectStore('price_edits', { keyPath: 'productId' });
                        editsStore.createIndex('timestamp', 'timestamp', { unique: false });
                        editsStore.createIndex('synced', 'synced', { unique: false });
                    }
                    
                    if (!db.objectStoreNames.contains('activity_log')) {
                        const logStore = db.createObjectStore('activity_log', { keyPath: 'id', autoIncrement: true });
                        logStore.createIndex('type', 'type', { unique: false });
                        logStore.createIndex('timestamp', 'timestamp', { unique: false });
                    }
                    
                    if (!db.objectStoreNames.contains('sync_log')) {
                        const syncLogStore = db.createObjectStore('sync_log', { keyPath: 'id', autoIncrement: true });
                        syncLogStore.createIndex('type', 'type', { unique: false });
                        syncLogStore.createIndex('timestamp', 'timestamp', { unique: false });
                    }
                    
                    if (!db.objectStoreNames.contains('index_log')) {
                        const indexLogStore = db.createObjectStore('index_log', { keyPath: 'id', autoIncrement: true });
                        indexLogStore.createIndex('type', 'type', { unique: false });
                        indexLogStore.createIndex('timestamp', 'timestamp', { unique: false });
                    }
                    
                    if (!db.objectStoreNames.contains('index_state')) {
                        db.createObjectStore('index_state', { keyPath: 'id' });
                    }
                    
                    if (!db.objectStoreNames.contains('app_config')) {
                        db.createObjectStore('app_config', { keyPath: 'key' });
                    }
                    
                    if (!db.objectStoreNames.contains('indexed_pages')) {
                        db.createObjectStore('indexed_pages', { keyPath: 'page' });
                    }
                    
                    if (!db.objectStoreNames.contains('sync_queue')) {
                        const syncStore = db.createObjectStore('sync_queue', { keyPath: 'id', autoIncrement: true });
                        syncStore.createIndex('status', 'status', { unique: false });
                        syncStore.createIndex('type', 'type', { unique: false });
                        syncStore.createIndex('productId', 'productId', { unique: false });
                    }

                    // Ø§Ø³ØªÙˆØ± Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø³ØªÙ‚Ù„
                    if (!db.objectStoreNames.contains('product_attributes')) {
                        const attrStore = db.createObjectStore('product_attributes', { keyPath: 'id', autoIncrement: true });
                        attrStore.createIndex('productId', 'productId', { unique: false });
                        attrStore.createIndex('attributeName', 'attributeName', { unique: false });
                        attrStore.createIndex('attributeValue', 'attributeValue', { unique: false });
                    }

                    // Ø§Ø³ØªÙˆØ± Ø¨Ø±Ø§ÛŒ Ø¢Ù…Ø§Ø± ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§
                    if (!db.objectStoreNames.contains('attribute_stats')) {
                        const statsStore = db.createObjectStore('attribute_stats', { keyPath: 'attributeName' });
                        statsStore.createIndex('count', 'count', { unique: false });
                    }
                };

                request.onsuccess = function(event) {
                    db = event.target.result;
                    dbInitialized = true;
                    
                    db.onerror = function(event) {
                        console.error('Ø®Ø·Ø§ÛŒ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡:', event.target.error);
                        log('Ø®Ø·Ø§ÛŒ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ Ø±Ø® Ø¯Ø§Ø¯', 'error');
                    };
                    
                    log('Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø´Ø¯', 'success');
                    resolve(db);
                };

                request.onerror = function(event) {
                    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡:', event.target.error);
                    reject(event.target.error);
                };
            });
        }

        async function executeDB(storeName, mode, callback) {
            if (!dbInitialized) {
                await initDatabase();
            }
            
            return new Promise((resolve, reject) => {
                try {
                    const transaction = db.transaction([storeName], mode);
                    const store = transaction.objectStore(storeName);
                    
                    const request = callback(store);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                    transaction.onerror = () => reject(transaction.error);
                } catch (error) {
                    reject(error);
                }
            });
        }

        // =========== Ø³ÛŒØ³ØªÙ… Ù„Ø§Ú¯ ===========
        async function log(message, type = 'info') {
            const logElement = document.getElementById('activityLog');
            const timestamp = new Date().toLocaleTimeString('fa-IR');
            
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.innerHTML = `
                <span>${message}</span>
                <span class="log-time">${timestamp}</span>
            `;
            
            if (logElement) {
                logElement.prepend(logEntry);
                if (logElement.children.length > 100) {
                    logElement.removeChild(logElement.lastChild);
                }
            }

            try {
                await executeDB('activity_log', 'readwrite', store => 
                    store.add({
                        message: message,
                        type: type,
                        timestamp: new Date().toISOString()
                    })
                );
                
                updateLogCount();
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ù„Ø§Ú¯:', error);
            }
        }

        async function logSync(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('fa-IR');
            const logElement = document.getElementById('syncLogContainer');
            
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.innerHTML = `
                <span>${message}</span>
                <span class="log-time">${timestamp}</span>
            `;
            
            if (logElement) {
                logElement.prepend(logEntry);
                if (logElement.children.length > 100) {
                    logElement.removeChild(logElement.lastChild);
                }
            }

            try {
                await executeDB('sync_log', 'readwrite', store => 
                    store.add({
                        message: message,
                        type: type,
                        timestamp: new Date().toISOString()
                    })
                );
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ù„Ø§Ú¯ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ:', error);
            }
        }

        async function logIndex(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('fa-IR');
            const logElement = document.getElementById('indexLogContainer');
            
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.innerHTML = `
                <span>${message}</span>
                <span class="log-time">${timestamp}</span>
            `;
            
            if (logElement) {
                logElement.prepend(logEntry);
                if (logElement.children.length > 100) {
                    logElement.removeChild(logElement.lastChild);
                }
            }

            try {
                await executeDB('index_log', 'readwrite', store => 
                    store.add({
                        message: message,
                        type: type,
                        timestamp: new Date().toISOString()
                    })
                );
                
                updateIndexLogCount();
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ù„Ø§Ú¯ Ø§ÛŒÙ†Ø¯Ú©Ø³:', error);
            }
        }

        // =========== Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§ ===========
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');
            errorText.textContent = message;
            errorDiv.style.display = 'block';
            log(`Ø®Ø·Ø§: ${message}`, 'error');
            
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 10000);
        }

        function retryLastOperation() {
            if (lastOperation && lastOperationData) {
                document.getElementById('errorMessage').style.display = 'none';
                setTimeout(() => {
                    lastOperation(...lastOperationData);
                }, 1000);
            }
        }

        // =========== Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø­ØµÙˆÙ„Ø§Øª ===========
        function selectAllProducts() {
            selectedProducts.clear();
            filteredProducts.forEach(product => {
                selectedProducts.add(product.id);
            });
            updateProductSelectionUI();
            updateSelectedCount();
            log('Ù‡Ù…Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù†Ø¯', 'info');
        }

        function deselectAllProducts() {
            selectedProducts.clear();
            updateProductSelectionUI();
            updateSelectedCount();
            log('Ø§Ù†ØªØ®Ø§Ø¨ Ù‡Ù…Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª Ù„ØºÙˆ Ø´Ø¯', 'info');
        }

        function toggleSelectAll(checkbox) {
            const checkboxes = document.querySelectorAll('.product-checkbox');
            checkboxes.forEach(cb => {
                cb.checked = checkbox.checked;
                const productId = parseInt(cb.getAttribute('data-id'));
                if (checkbox.checked) {
                    selectedProducts.add(productId);
                } else {
                    selectedProducts.delete(productId);
                }
            });
            updateSelectedCount();
        }

        function toggleProductSelection(productId, checkbox) {
            if (checkbox.checked) {
                selectedProducts.add(productId);
            } else {
                selectedProducts.delete(productId);
            }
            
            const allCheckboxes = document.querySelectorAll('.product-checkbox');
            const selectAllCheckbox = document.getElementById('selectAllCheckbox');
            selectAllCheckbox.checked = allCheckboxes.length === selectedProducts.size;
            
            updateSelectedCount();
        }
// ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù Ù‡Ù…Ù‡ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ
async function deleteAllSyncItems() {
    if (syncQueue.length === 0) {
        showError('Ù‡ÛŒÚ† Ø¢ÛŒØªÙ…ÛŒ Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯');
        return;
    }

    if (!confirm(`Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ù‡Ù…Ù‡ ${syncQueue.length} Ø¢ÛŒØªÙ… Ø§Ø² ØµÙ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ùˆ Ù‡Ù…Ú†Ù†ÛŒÙ† Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ù… ÙˆÛŒØ±Ø§ÛŒØ´â€ŒÙ‡Ø§ÛŒ Ù‚ÛŒÙ…Øª Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`)) {
        return;
    }

    try {
        // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú©Ù„ Ø§Ø³ØªÙˆØ± sync_queue
        await executeDB('sync_queue', 'readwrite', store => store.clear());

        // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú©Ù„ Ø§Ø³ØªÙˆØ± price_edits
        await executeDB('price_edits', 'readwrite', store => store.clear());

        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ØªØºÛŒØ±Ù‡Ø§
        syncQueue = [];
        selectedSyncItems.clear();
        priceEdits.clear();   // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Map Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ÛŒ ÙˆÛŒØ±Ø§ÛŒØ´â€ŒØ´Ø¯Ù‡
        pendingSyncCount = 0;

        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI
        displaySyncItems();           // Ù†Ù…Ø§ÛŒØ´ Ø®Ø§Ù„ÛŒ Ø¯Ø± Ù„ÛŒØ³Øª Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ
        updateStats();                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø§Ø± (ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯Ù‡â€ŒÙ‡Ø§ ØµÙØ± Ù…ÛŒâ€ŒØ´ÙˆØ¯)
        displayProducts();            // Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø¬Ø¯ÙˆÙ„ Ù…Ø­ØµÙˆÙ„Ø§Øª (ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù‚ÛŒÙ…Øª Ø®Ø§Ù„ÛŒ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯)
        updatePendingChanges();       // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ø´Ø§Ù†Ú¯Ø± ØªØºÛŒÛŒØ±Ø§Øª Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±
        updateSyncSelectionCount();   // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡â€ŒÙ‡Ø§

        log('Ù‡Ù…Ù‡ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ùˆ ÙˆÛŒØ±Ø§ÛŒØ´â€ŒÙ‡Ø§ÛŒ Ù‚ÛŒÙ…Øª Ø­Ø°Ù Ø´Ø¯Ù†Ø¯', 'warning');
    } catch (error) {
        console.error('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù‡Ù…Ù‡ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§:', error);
        showError('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§');
    }
}
        // ** ØªØ§Ø¨Ø¹ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§ (Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù¾Ù†Ù„ Ø¬Ø¯ÛŒØ¯) **
        function updateSelectedCount() {
            document.getElementById('selectedCount').textContent = selectedProducts.size;
            const selectedCountRef = document.getElementById('selectedCountRef');
            if (selectedCountRef) {
                selectedCountRef.textContent = selectedProducts.size;
            }
        }

        function updateProductSelectionUI() {
            const checkboxes = document.querySelectorAll('.product-checkbox');
            checkboxes.forEach(cb => {
                const productId = parseInt(cb.getAttribute('data-id'));
                cb.checked = selectedProducts.has(productId);
            });
        }

        // =========== ØªØºÛŒÛŒØ± Ø¯Ø³ØªÙ‡â€ŒØ§ÛŒ Ù‚ÛŒÙ…Øª (Ø¯Ø±ØµØ¯ÛŒ) ===========
        async function applyBatchPriceChange(type) {
            const percentInput = document.getElementById('priceIncreasePercent');
            const percent = parseFloat(percentInput.value);
            const applyType = document.getElementById('priceApplyType').value;
            
            if (isNaN(percent) || percent === 0) {
                showError('Ù„Ø·ÙØ§ Ø¯Ø±ØµØ¯ Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            let productsToUpdate = [];
            
            switch(applyType) {
                case 'all':
                    productsToUpdate = allProducts;
                    break;
                case 'filtered':
                    productsToUpdate = filteredProducts;
                    break;
                case 'selected':
                    productsToUpdate = allProducts.filter(p => selectedProducts.has(p.id));
                    if (productsToUpdate.length === 0) {
                        showError('Ù‡ÛŒÚ† Ù…Ø­ØµÙˆÙ„ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª');
                        return;
                    }
                    break;
            }
            
            if (productsToUpdate.length === 0) {
                showError('Ù‡ÛŒÚ† Ù…Ø­ØµÙˆÙ„ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø¹Ù…Ø§Ù„ ØªØºÛŒÛŒØ± ÛŒØ§ÙØª Ù†Ø´Ø¯');
                return;
            }
            
            if (!confirm(`Ø¢ÛŒØ§ Ø§Ø² ${type === 'increase' ? 'Ø§ÙØ²Ø§ÛŒØ´' : 'Ú©Ø§Ù‡Ø´'} ${Math.abs(percent)}% Ù‚ÛŒÙ…Øª ${productsToUpdate.length} Ù…Ø­ØµÙˆÙ„ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`)) {
                return;
            }
            
            lastOperation = applyBatchPriceChange;
            lastOperationData = [type];
            
            try {
                let successCount = 0;
                let errorCount = 0;
                let totalChange = 0;
                
                for (const product of productsToUpdate) {
                    if (product.price > 0) {
                        const newPrice = type === 'increase' 
                            ? Math.round(product.price * (1 + percent / 100))
                            : Math.round(product.price * (1 - percent / 100));
                        
                        try {
                            await updatePrice(product.id, newPrice);
                            successCount++;
                            totalChange += Math.abs(newPrice - product.price);
                        } catch (error) {
                            errorCount++;
                            console.error(`Ø®Ø·Ø§ Ø¯Ø± ØªØºÛŒÛŒØ± Ù‚ÛŒÙ…Øª Ù…Ø­ØµÙˆÙ„ ${product.id}:`, error);
                        }
                    }
                }
                
                showBatchPriceSummary(successCount, errorCount, totalChange, type, percent);
                log(`${type === 'increase' ? 'Ø§ÙØ²Ø§ÛŒØ´' : 'Ú©Ø§Ù‡Ø´'} ${percent}% Ù‚ÛŒÙ…Øª Ø¨Ø±Ø§ÛŒ ${successCount} Ù…Ø­ØµÙˆÙ„ Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯. Ù…Ø¬Ù…ÙˆØ¹ ØªØºÛŒÛŒØ±Ø§Øª: ${totalChange.toLocaleString()} ØªÙˆÙ…Ø§Ù†`, 'success');
                
                if (errorCount > 0) {
                    showError(`${errorCount} Ù…Ø­ØµÙˆÙ„ Ø¨Ø§ Ø®Ø·Ø§ Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯`);
                }
                
            } catch (error) {
                showError(`Ø®Ø·Ø§ Ø¯Ø± Ø§Ø¹Ù…Ø§Ù„ ØªØºÛŒÛŒØ±Ø§Øª: ${error.message}`);
            }
        }

        function showBatchPriceSummary(successCount, errorCount, totalChange, type, percent) {
            const summaryDiv = document.getElementById('batchPriceSummary');
            const detailsDiv = document.getElementById('batchPriceDetails');
            
            detailsDiv.innerHTML = `
                <div class="price-summary-item">
                    <span>ØªØ¹Ø¯Ø§Ø¯ Ù…Ø­ØµÙˆÙ„Ø§Øª:</span>
                    <span>${successCount} Ù…ÙˆÙÙ‚ØŒ ${errorCount} Ù†Ø§Ù…ÙˆÙÙ‚</span>
                </div>
                <div class="price-summary-item">
                    <span>Ù†ÙˆØ¹ ØªØºÛŒÛŒØ±:</span>
                    <span>${type === 'increase' ? 'Ø§ÙØ²Ø§ÛŒØ´' : 'Ú©Ø§Ù‡Ø´'} ${Math.abs(percent)}%</span>
                </div>
                <div class="price-summary-item">
                    <span>Ù…Ø¬Ù…ÙˆØ¹ ØªØºÛŒÛŒØ±Ø§Øª:</span>
                    <span>${totalChange.toLocaleString()} ØªÙˆÙ…Ø§Ù†</span>
                </div>
            `;
            
            summaryDiv.style.display = 'block';
            
            setTimeout(() => {
                summaryDiv.style.display = 'none';
            }, 10000);
        }

        // =========== ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯: Ø§Ø¹Ù…Ø§Ù„ Ù‚ÛŒÙ…Øª Ù‡Ø± Ú¯Ø±Ù… Ø¯Ø³ØªÙ‡â€ŒØ§ÛŒ ===========
        async function applyBatchPricePerGram() {
            const targetPricePerGramInput = document.getElementById('targetPricePerGram');
            const targetPricePerGram = parseFloat(targetPricePerGramInput.value);
            const applyType = document.getElementById('pricePerGramApplyType').value;

            if (isNaN(targetPricePerGram) || targetPricePerGram <= 0) {
                showError('Ù„Ø·ÙØ§ Ù‚ÛŒÙ…Øª Ù‡Ø± Ú¯Ø±Ù… Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                return;
            }

            let productsToUpdate = [];

            switch(applyType) {
                case 'all':
                    productsToUpdate = allProducts;
                    break;
                case 'filtered':
                    productsToUpdate = filteredProducts;
                    break;
                case 'selected':
                    productsToUpdate = allProducts.filter(p => selectedProducts.has(p.id));
                    if (productsToUpdate.length === 0) {
                        showError('Ù‡ÛŒÚ† Ù…Ø­ØµÙˆÙ„ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª');
                        return;
                    }
                    break;
            }

            // ÙÛŒÙ„ØªØ± Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¯Ø§Ø±Ø§ÛŒ ÙˆØ²Ù† Ù…Ø¹ØªØ¨Ø±
            const validProducts = productsToUpdate.filter(p => p.weight > 0);
            const skippedProducts = productsToUpdate.length - validProducts.length;

            if (validProducts.length === 0) {
                showError('Ù‡ÛŒÚ† Ù…Ø­ØµÙˆÙ„ Ø¨Ø§ ÙˆØ²Ù† Ù…Ø¹ØªØ¨Ø± Ø¨Ø±Ø§ÛŒ Ø§Ø¹Ù…Ø§Ù„ ØªØºÛŒÛŒØ± ÛŒØ§ÙØª Ù†Ø´Ø¯');
                return;
            }

            if (!confirm(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ø¹Ù…Ø§Ù„ Ù‚ÛŒÙ…Øª Ù‡Ø± Ú¯Ø±Ù… ${targetPricePerGram.toLocaleString()} ØªÙˆÙ…Ø§Ù† Ø¨Ø±Ø§ÛŒ ${validProducts.length} Ù…Ø­ØµÙˆÙ„ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ${skippedProducts > 0 ? `\n${skippedProducts} Ù…Ø­ØµÙˆÙ„ Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ Ù†Ø¯Ø§Ø´ØªÙ† ÙˆØ²Ù† Ù…Ø¹ØªØ¨Ø± Ø±Ø¯ Ø´Ø¯Ù†Ø¯.` : ''}`)) {
                return;
            }

            let successCount = 0;
            let errorCount = 0;
            let totalPriceChange = 0;

            for (const product of validProducts) {
                const newTotalPrice = Math.round(product.weight * targetPricePerGram);
                // ÙÙ‚Ø· Ø¯Ø± ØµÙˆØ±ØªÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ù† Ú©Ù‡ Ù‚ÛŒÙ…Øª Ø¬Ø¯ÛŒØ¯ Ù…ØªÙØ§ÙˆØª Ø¨Ø§Ø´Ø¯
                if (newTotalPrice !== (priceEdits.get(product.id) || product.price)) {
                    try {
                        await updatePrice(product.id, newTotalPrice);
                        successCount++;
                        totalPriceChange += Math.abs(newTotalPrice - product.price);
                    } catch (error) {
                        errorCount++;
                        console.error(`Ø®Ø·Ø§ Ø¯Ø± ØªØºÛŒÛŒØ± Ù‚ÛŒÙ…Øª Ù…Ø­ØµÙˆÙ„ ${product.id}:`, error);
                    }
                } else {
                    successCount++; // Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±ØŒ Ø§Ù…Ø§ Ù…ÙˆÙÙ‚ Ù…Ø­Ø³ÙˆØ¨ Ù…ÛŒâ€ŒØ´ÙˆØ¯
                }
            }

            // Ù†Ù…Ø§ÛŒØ´ Ø®Ù„Ø§ØµÙ‡
            const summaryDiv = document.getElementById('batchPricePerGramSummary');
            const detailsDiv = document.getElementById('batchPricePerGramDetails');
            
            detailsDiv.innerHTML = `
                <div class="price-summary-item">
                    <span>ØªØ¹Ø¯Ø§Ø¯ Ù…Ø­ØµÙˆÙ„Ø§Øª:</span>
                    <span>${successCount} Ù…ÙˆÙÙ‚ØŒ ${errorCount} Ù†Ø§Ù…ÙˆÙÙ‚</span>
                </div>
                <div class="price-summary-item">
                    <span>Ù‚ÛŒÙ…Øª Ù‡Ø± Ú¯Ø±Ù… Ø¬Ø¯ÛŒØ¯:</span>
                    <span>${targetPricePerGram.toLocaleString()} ØªÙˆÙ…Ø§Ù†</span>
                </div>
                <div class="price-summary-item">
                    <span>Ù…Ø¬Ù…ÙˆØ¹ ØªØºÛŒÛŒØ±Ø§Øª Ù‚ÛŒÙ…Øª Ú©Ù„:</span>
                    <span>${totalPriceChange.toLocaleString()} ØªÙˆÙ…Ø§Ù†</span>
                </div>
                ${skippedProducts > 0 ? `<div class="price-summary-item" style="color: var(--warning);">
                    <span>Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¨Ø¯ÙˆÙ† ÙˆØ²Ù† Ø±Ø¯ Ø´Ø¯Ù‡:</span>
                    <span>${skippedProducts}</span>
                </div>` : ''}
            `;
            
            summaryDiv.style.display = 'block';
            
            log(`Ø§Ø¹Ù…Ø§Ù„ Ù‚ÛŒÙ…Øª Ù‡Ø± Ú¯Ø±Ù… ${targetPricePerGram.toLocaleString()} ØªÙˆÙ…Ø§Ù† Ø¨Ø±Ø§ÛŒ ${successCount} Ù…Ø­ØµÙˆÙ„`, 'success');
            
            setTimeout(() => {
                summaryDiv.style.display = 'none';
            }, 10000);
        }

        // =========== Ù…Ø¯ÛŒØ±ÛŒØª Ù‚ÛŒÙ…Øª ===========
        async function updatePrice(productId, newPrice) {
            const price = parseFloat(newPrice);
            const product = allProducts.find(p => p.id === productId);
            
            if (!product) {
                console.error(`Ù…Ø­ØµÙˆÙ„ Ø¨Ø§ Ø´Ù†Ø§Ø³Ù‡ ${productId} ÛŒØ§ÙØª Ù†Ø´Ø¯`);
                return;
            }
            
            if (isNaN(price) || price <= 0) {
                if (priceEdits.has(productId)) {
                    priceEdits.delete(productId);
                    
                    await executeDB('price_edits', 'readwrite', store => 
                        store.delete(productId)
                    );
                    
                    await removeFromSyncQueue(productId);
                    log(`ÙˆÛŒØ±Ø§ÛŒØ´ Ù‚ÛŒÙ…Øª Ù…Ø­ØµÙˆÙ„ "${product.name}" Ø­Ø°Ù Ø´Ø¯`, 'warning');
                }
            } else {
                const oldPrice = product.price || 0;
                const percentChange = oldPrice > 0 ? ((price - oldPrice) / oldPrice * 100).toFixed(2) : 100;
                
                priceEdits.set(productId, price);
                
                await executeDB('price_edits', 'readwrite', store => 
                    store.put({
                        productId: productId,
                        newPrice: price,
                        oldPrice: oldPrice,
                        percentChange: percentChange,
                        timestamp: new Date().toISOString(),
                        synced: false,
                        productName: product.name
                    })
                );
                
                await addToSyncQueue(productId, 'price_update');
                log(`Ù‚ÛŒÙ…Øª Ù…Ø­ØµÙˆÙ„ "${product.name}" Ø§Ø² ${oldPrice.toLocaleString()} Ø¨Ù‡ ${price.toLocaleString()} ØªÙˆÙ…Ø§Ù† ØªØºÛŒÛŒØ± ÛŒØ§ÙØª (${percentChange}%)`, 'success');
            }
            
            updateStats();
            displayProducts();
            updatePendingChanges();
        }

        async function addToSyncQueue(productId, type) {
            try {
                await executeDB('sync_queue', 'readwrite', store => 
                    store.add({
                        productId: productId,
                        type: type,
                        status: 'pending',
                        timestamp: new Date().toISOString(),
                        retryCount: 0
                    })
                );
                
                pendingSyncCount++;
                updatePendingChanges();
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ ØµÙ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ:', error);
            }
        }

        async function removeFromSyncQueue(productId) {
            try {
                const transaction = db.transaction(['sync_queue'], 'readwrite');
                const store = transaction.objectStore('sync_queue');
                const index = store.index('productId');
                const request = index.getKey(productId);
                
                request.onsuccess = async () => {
                    const key = request.result;
                    if (key) {
                        await executeDB('sync_queue', 'readwrite', s => s.delete(key));
                        pendingSyncCount = Math.max(0, pendingSyncCount - 1);
                        updatePendingChanges();
                    }
                };
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ø§Ø² ØµÙ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ:', error);
            }
        }

        function updatePendingChanges() {
            const badge = document.getElementById('pendingChangesBadge');
            badge.textContent = pendingSyncCount;
            badge.style.display = pendingSyncCount > 0 ? 'inline-block' : 'none';
        }

        // =========== Ù…Ø¯ÛŒØ±ÛŒØª Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ ===========
        async function loadSyncQueue() {
            try {
                const syncItems = await executeDB('sync_queue', 'readonly', store => 
                    store.getAll()
                );
                
                syncQueue = syncItems;
                displaySyncItems();
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØµÙ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ:', error);
            }
        }

        async function displaySyncItems() {
            const container = document.getElementById('syncItemsContainer');
            container.innerHTML = '';
            
            if (syncQueue.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <span style="font-size: 48px; display: block; margin-bottom: 16px;">âœ…</span>
                        Ù‡ÛŒÚ† ØªØºÛŒÛŒØ±ÛŒ Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯
                    </div>
                `;
                return;
            }
            
            for (const item of syncQueue) {
                const product = allProducts.find(p => p.id === item.productId);
                if (!product) continue;
                
                const syncItem = document.createElement('div');
                syncItem.className = 'sync-item';
                syncItem.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <input type="checkbox" class="sync-checkbox" 
                               data-id="${item.id}" 
                               ${selectedSyncItems.has(item.id) ? 'checked' : ''}
                               onchange="toggleSyncItemSelection(${item.id}, this)">
                    </div>
                    <div class="sync-item-info">
                        <div class="sync-item-name">${product.name}</div>
                        <div class="sync-item-details">
                            <span>Ø´Ù†Ø§Ø³Ù‡: ${product.id}</span>
                            <span>Ù‚ÛŒÙ…Øª Ø¬Ø¯ÛŒØ¯: ${priceEdits.get(product.id)?.toLocaleString() || '---'} ØªÙˆÙ…Ø§Ù†</span>
                            <span>Ø²Ù…Ø§Ù† Ø«Ø¨Øª: ${new Date(item.timestamp).toLocaleString('fa-IR')}</span>
                        </div>
                    </div>
                    <div class="sync-item-actions">
                        <button class="action-btn" onclick="syncSingleItem(${item.id})" title="Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø§ÛŒÙ† Ø¢ÛŒØªÙ…">
                            <span class="icon">ğŸ”„</span>
                        </button>
                        <button class="action-btn" onclick="removeSyncItem(${item.id})" title="Ø­Ø°Ù Ø§Ø² ØµÙ">
                            <span class="icon">ğŸ—‘ï¸</span>
                        </button>
                    </div>
                `;
                container.appendChild(syncItem);
            }
            
            updateSyncSelectionCount();
        }

        function toggleSyncItemSelection(itemId, checkbox) {
            if (checkbox.checked) {
                selectedSyncItems.add(itemId);
            } else {
                selectedSyncItems.delete(itemId);
            }
            
            const allCheckboxes = document.querySelectorAll('.sync-checkbox');
            const selectAllCheckbox = document.getElementById('selectAllSync');
            selectAllCheckbox.checked = allCheckboxes.length === selectedSyncItems.size;
            
            updateSyncSelectionCount();
        }

        function toggleSelectAllSyncItems() {
            const checkbox = document.getElementById('selectAllSync');
            const checkboxes = document.querySelectorAll('.sync-checkbox');
            
            checkboxes.forEach(cb => {
                cb.checked = checkbox.checked;
                const itemId = parseInt(cb.getAttribute('data-id'));
                if (checkbox.checked) {
                    selectedSyncItems.add(itemId);
                } else {
                    selectedSyncItems.delete(itemId);
                }
            });
            
            updateSyncSelectionCount();
        }

        function updateSyncSelectionCount() {
            document.getElementById('selectedSyncCount').textContent = selectedSyncItems.size;
            document.getElementById('totalSyncCount').textContent = syncQueue.length;
        }

        async function syncSelectedChanges() {
            if (selectedSyncItems.size === 0) {
                showError('Ù„Ø·ÙØ§ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ø¢ÛŒØªÙ… Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            const itemsToSync = syncQueue.filter(item => selectedSyncItems.has(item.id));
            await startSyncProcess(itemsToSync);
        }

        async function syncAllPendingChanges() {
            if (syncQueue.length === 0) {
                showError('Ù‡ÛŒÚ† ØªØºÛŒÛŒØ±ÛŒ Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯');
                return;
            }
            
            if (!confirm(`Ø¢ÛŒØ§ Ø§Ø² Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ ${syncQueue.length} ØªØºÛŒÛŒØ± Ø¨Ø§ Ø³Ø§ÛŒØª Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`)) {
                return;
            }
            
            await startSyncProcess(syncQueue);
        }

        async function syncSingleItem(itemId) {
            const item = syncQueue.find(i => i.id === itemId);
            if (!item) return;
            
            await startSyncProcess([item]);
        }

        async function removeSyncItem(itemId) {
            if (!confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ø¢ÛŒØªÙ… Ø§Ø² ØµÙ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')) {
                return;
            }
            
            try {
                await executeDB('sync_queue', 'readwrite', store => store.delete(itemId));
                syncQueue = syncQueue.filter(item => item.id !== itemId);
                selectedSyncItems.delete(itemId);
                displaySyncItems();
                updatePendingChanges();
                log('Ø¢ÛŒØªÙ… Ø§Ø² ØµÙ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø­Ø°Ù Ø´Ø¯', 'warning');
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ø¢ÛŒØªÙ…:', error);
                showError('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ø¢ÛŒØªÙ…');
            }
        }

        async function startSyncProcess(items) {
            if (!isOnline) {
                showError('Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ÛŒØ¯ Ø¢Ù†Ù„Ø§ÛŒÙ† Ø¨Ø§Ø´ÛŒØ¯.');
                return;
            }
            
            if (isSyncing) {
                showError('Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù… Ø§Ø³Øª. Ù„Ø·ÙØ§ ØµØ¨Ø± Ú©Ù†ÛŒØ¯.');
                return;
            }
            
            isSyncing = true;
            isSyncPaused = false;
            syncStartTime = Date.now();
            
            // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´ Ù¾ÛŒØ´Ø±ÙØª
            document.getElementById('syncProgressSection').style.display = 'block';
            document.getElementById('syncSuccessCount').textContent = '0';
            document.getElementById('syncErrorCount').textContent = '0';
            document.getElementById('syncPendingCount').textContent = items.length;
            document.getElementById('syncTotalCount').textContent = items.length;
            document.getElementById('syncProgressPercent').textContent = '0%';
            document.getElementById('syncProgressFill').style.width = '0%';
            
            let successCount = 0;
            let errorCount = 0;
            
            for (let i = 0; i < items.length; i++) {
                if (!isSyncing) break;
                if (isSyncPaused) {
                    logSync('Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ù…ØªÙˆÙ‚Ù Ø´Ø¯', 'warning');
                    break;
                }
                
                const item = items[i];
                const product = allProducts.find(p => p.id === item.productId);
                
                if (!product) {
                    errorCount++;
                    continue;
                }
                
                try {
                    // Ø¯Ø±ÛŒØ§ÙØª Ù‚ÛŒÙ…Øª Ø¬Ø¯ÛŒØ¯ Ø§Ø² price_edits
                    const priceEdit = await executeDB('price_edits', 'readonly', store => 
                        store.get(item.productId)
                    );
                    
                    if (!priceEdit) {
                        errorCount++;
                        logSync(`Ù‚ÛŒÙ…Øª Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù…Ø­ØµÙˆÙ„ "${product.name}" ÛŒØ§ÙØª Ù†Ø´Ø¯`, 'error');
                        continue;
                    }
                    
                    // API call Ø¨Ø±Ø§ÛŒ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù‚ÛŒÙ…Øª Ø¯Ø± ÙˆÙˆÚ©Ø§Ù…Ø±Ø³
                    const updateUrl = `${appConfig.siteUrl}/wp-json/wc/v3/products/${item.productId}?consumer_key=${appConfig.consumerKey}&consumer_secret=${appConfig.consumerSecret}`;
                    
                    logSync(`Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù‚ÛŒÙ…Øª Ù…Ø­ØµÙˆÙ„ "${product.name}" Ø¨Ù‡ ${priceEdit.newPrice.toLocaleString()} ØªÙˆÙ…Ø§Ù†...`, 'info');
                    
                    const response = await fetch(updateUrl, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            regular_price: priceEdit.newPrice.toString()
                        })
                    });
                    
                    if (response.ok) {
                        // Ø¨Ø±Ú†Ø³Ø¨ Ø²Ø¯Ù† Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡
                        priceEdit.synced = true;
                        priceEdit.syncTime = new Date().toISOString();
                        await executeDB('price_edits', 'readwrite', store => store.put(priceEdit));
                        
                        // Ø­Ø°Ù Ø§Ø² ØµÙ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ
                        await executeDB('sync_queue', 'readwrite', store => store.delete(item.id));
                        
                        successCount++;
                        logSync(`Ù‚ÛŒÙ…Øª Ù…Ø­ØµÙˆÙ„ "${product.name}" Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯`, 'success');
                    } else {
                        errorCount++;
                        const errorText = await response.text();
                        logSync(`Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…Ø­ØµÙˆÙ„ "${product.name}": ${response.status}`, 'error');
                        
                        // Ø§ÙØ²Ø§ÛŒØ´ Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯
                        item.retryCount = (item.retryCount || 0) + 1;
                        if (item.retryCount >= 3) {
                            await executeDB('sync_queue', 'readwrite', store => store.delete(item.id));
                            logSync(`Ø¢ÛŒØªÙ… "${product.name}" Ù¾Ø³ Ø§Ø² Û³ Ø¨Ø§Ø± ØªÙ„Ø§Ø´ Ù†Ø§Ù…ÙˆÙÙ‚ Ø­Ø°Ù Ø´Ø¯`, 'warning');
                        } else {
                            await executeDB('sync_queue', 'readwrite', store => store.put(item));
                        }
                    }
                } catch (error) {
                    errorCount++;
                    logSync(`Ø®Ø·Ø§ Ø¯Ø± Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ù…Ø­ØµÙˆÙ„ "${product.name}": ${error.message}`, 'error');
                }
                
                // Ø¢Ù¾Ø¯ÛŒØª Ù¾ÛŒØ´Ø±ÙØª
                const progress = Math.round(((i + 1) / items.length) * 100);
                document.getElementById('syncProgressPercent').textContent = `${progress}%`;
                document.getElementById('syncProgressFill').style.width = `${progress}%`;
                document.getElementById('syncSuccessCount').textContent = successCount;
                document.getElementById('syncErrorCount').textContent = errorCount;
                document.getElementById('syncPendingCount').textContent = items.length - (i + 1);
            }
            
            // ØªÚ©Ù…ÛŒÙ„ ÙØ±Ø¢ÛŒÙ†Ø¯
            isSyncing = false;
            appConfig.lastSyncTime = new Date().toISOString();
            await saveSettings();
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¬Ø¯Ø¯ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
            await loadSyncQueue();
            updateStats();
            pendingSyncCount = syncQueue.length;
            updatePendingChanges();
            
            document.getElementById('syncStatus').innerHTML = `
                <span class="icon">ğŸ”„</span>
                <span>Ø¢Ø®Ø±ÛŒÙ† Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ: ${new Date().toLocaleTimeString('fa-IR')}</span>
            `;
            
            logSync(`Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯. Ù…ÙˆÙÙ‚: ${successCount}, Ù†Ø§Ù…ÙˆÙÙ‚: ${errorCount}`, 
                errorCount === 0 ? 'success' : 'warning');
            
            alert(`Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯.\nÙ…ÙˆÙÙ‚: ${successCount}\nÙ†Ø§Ù…ÙˆÙÙ‚: ${errorCount}`);
            
            // Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† Ø¨Ø®Ø´ Ù¾ÛŒØ´Ø±ÙØª Ø¨Ø¹Ø¯ Ø§Ø² 5 Ø«Ø§Ù†ÛŒÙ‡
            setTimeout(() => {
                document.getElementById('syncProgressSection').style.display = 'none';
            }, 5000);
        }

        function pauseSync() {
            if (!isSyncing) return;
            
            isSyncPaused = true;
            document.getElementById('pauseSyncBtn').style.display = 'none';
            logSync('Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ù…ØªÙˆÙ‚Ù Ø´Ø¯', 'warning');
        }

        function stopSync() {
            isSyncing = false;
            isSyncPaused = false;
            document.getElementById('syncProgressSection').style.display = 'none';
            logSync('Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ù…ØªÙˆÙ‚Ù Ø´Ø¯', 'warning');
        }

        async function clearSyncLogs() {
            try {
                await executeDB('sync_log', 'readwrite', store => store.clear());
                document.getElementById('syncLogContainer').innerHTML = '';
                logSync('Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ù¾Ø§Ú© Ø´Ø¯Ù†Ø¯', 'warning');
            } catch (error) {
                showError('Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ');
            }
        }

        // =========== Ù…Ø¯ÛŒØ±ÛŒØª Ø§ÛŒÙ†Ø¯Ú©Ø³ ===========
        async function startIndexing() {
            if (isIndexing) {
                alert('ÙØ±Ø¢ÛŒÙ†Ø¯ Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§Ø³Øª!');
                return;
            }

            isIndexing = true;
            isPaused = false;
            indexStartTime = Date.now();
            
            document.getElementById('startIndexBtn').disabled = true;
            document.getElementById('pauseBtn').disabled = false;
            document.getElementById('continueBtn').style.display = 'none';
            
            logIndex('Ø´Ø±ÙˆØ¹ ÙØ±Ø¢ÛŒÙ†Ø¯ Ø§ÛŒÙ†Ø¯Ú©Ø³ Ù‡ÙˆØ´Ù…Ù†Ø¯...', 'info');
            
            try {
                await loadIndexState();
                
                const testUrl = `${appConfig.siteUrl}/wp-json/wc/v3/products?per_page=1&consumer_key=${appConfig.consumerKey}&consumer_secret=${appConfig.consumerSecret}`;
                const response = await fetch(testUrl);
                
                if (!response.ok) {
                    throw new Error(`Ø®Ø·Ø§ÛŒ HTTP: ${response.status}`);
                }
                
                totalProductsCount = parseInt(response.headers.get('X-WP-Total')) || 0;
                
                logIndex(`ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ù…Ø­ØµÙˆÙ„Ø§Øª: ${totalProductsCount}`, 'info');
                
                startIndexTimer();
                
                let startPage = 1;
                if (indexedPages.size > 0) {
                    const maxPage = Math.max(...Array.from(indexedPages));
                    if (maxPage * appConfig.perPage < totalProductsCount) {
                        startPage = maxPage + 1;
                        logIndex(`Ø§Ø¯Ø§Ù…Ù‡ Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø§Ø² ØµÙØ­Ù‡ ${startPage}`, 'info');
                    } else {
                        logIndex('Ø§ÛŒÙ†Ø¯Ú©Ø³ Ù‚Ø¨Ù„Ø§Ù‹ Ú©Ø§Ù…Ù„ Ø´Ø¯Ù‡ Ø§Ø³Øª', 'warning');
                        completeIndexing();
                        return;
                    }
                }
                
                const totalPages = Math.ceil(totalProductsCount / appConfig.perPage);
                for (let page = startPage; page <= totalPages; page++) {
                    if (!isIndexing) break;
                    if (isPaused) {
                        await saveIndexState();
                        logIndex('Ø§ÛŒÙ†Ø¯Ú©Ø³ Ù…ØªÙˆÙ‚Ù Ø´Ø¯. Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ø§Ù…Ù‡ Ø¯Ú©Ù…Ù‡ Ø§Ø¯Ø§Ù…Ù‡ Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯.', 'warning');
                        break;
                    }
                    
                    await indexPage(page);
                    
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
                
                if (isIndexing && !isPaused) {
                    await completeIndexing();
                }
                
            } catch (error) {
                logIndex(`Ø®Ø·Ø§ Ø¯Ø± ÙØ±Ø¢ÛŒÙ†Ø¯ Ø§ÛŒÙ†Ø¯Ú©Ø³: ${error.message}`, 'error');
                isIndexing = false;
                updateIndexControls();
                showError(`Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒÙ†Ø¯Ú©Ø³: ${error.message}`);
            }
        }

        async function indexPage(page) {
            try {
                const url = `${appConfig.siteUrl}/wp-json/wc/v3/products?per_page=${appConfig.perPage}&page=${page}&consumer_key=${appConfig.consumerKey}&consumer_secret=${appConfig.consumerSecret}&_fields=id,name,slug,sku,price,regular_price,sale_price,date_created,date_modified,weight,dimensions,categories,attributes,images,permalink,meta_data`;
                
                const response = await fetch(url);
                if (!response.ok) {
                    if (response.status === 500) {
                        logIndex(`Ø®Ø·Ø§ÛŒ Ø³Ø±ÙˆØ± Ø¯Ø± ØµÙØ­Ù‡ ${page}ØŒ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯...`, 'warning');
                        await new Promise(resolve => setTimeout(resolve, 2000));
                        return await indexPage(page);
                    }
                    throw new Error(`Ø®Ø·Ø§ Ø¯Ø± ØµÙØ­Ù‡ ${page}: ${response.status}`);
                }
                
                const products = await response.json();
                if (products.length === 0) return;
                
                let attributesCount = 0;
                
                for (const product of products) {
                    const weight = parseFloat(product.weight) || 0;
                    const price = parseFloat(product.price) || 0;
                    const pricePerGram = weight > 0 && price > 0 ? price / weight : 0;
                    
                    let dimensions = null;
                    if (product.meta_data) {
                        const lengthMeta = product.meta_data.find(m => m.key === '_length');
                        const widthMeta = product.meta_data.find(m => m.key === '_width');
                        const heightMeta = product.meta_data.find(m => m.key === '_height');
                        
                        if (lengthMeta || widthMeta || heightMeta) {
                            dimensions = {
                                length: lengthMeta ? parseFloat(lengthMeta.value) : 0,
                                width: widthMeta ? parseFloat(widthMeta.value) : 0,
                                height: heightMeta ? parseFloat(heightMeta.value) : 0
                            };
                        }
                    }
                    
                    // Ù¾Ø±Ø¯Ø§Ø²Ø´ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§
                    let productAttributes = [];
                    if (product.attributes && Array.isArray(product.attributes)) {
                        for (const attr of product.attributes) {
                            if (attr.name && attr.options && attr.options.length > 0) {
                                // Ø°Ø®ÛŒØ±Ù‡ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ Ø¯Ø± Ø§Ø³ØªÙˆØ± Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡
                                for (const option of attr.options) {
                                    await executeDB('product_attributes', 'readwrite', store => 
                                        store.add({
                                            productId: product.id,
                                            attributeName: attr.name,
                                            attributeValue: option,
                                            timestamp: new Date().toISOString()
                                        })
                                    );
                                    attributesCount++;
                                }
                                
                                // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ù„ÛŒØ³Øª ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø­ØµÙˆÙ„
                                productAttributes.push({
                                    name: attr.name,
                                    options: attr.options,
                                    visible: attr.visible || false,
                                    variation: attr.variation || false
                                });
                            }
                        }
                    }
                    
                    const productData = {
                        id: product.id,
                        name: product.name,
                        slug: product.slug,
                        sku: product.sku || '',
                        price: price,
                        regular_price: parseFloat(product.regular_price) || 0,
                        sale_price: parseFloat(product.sale_price) || 0,
                        date_created: product.date_created,
                        date_modified: product.date_modified,
                        weight: weight,
                        dimensions: dimensions || product.dimensions || null,
                        category: product.categories?.[0]?.name || 'Ø¨Ø¯ÙˆÙ† Ø¯Ø³ØªÙ‡',
                        attributes: productAttributes,
                        image: product.images?.[0]?.src || '',
                        permalink: product.permalink || `${appConfig.siteUrl}/product/${product.slug}`,
                        price_per_gram: pricePerGram,
                        last_indexed: new Date().toISOString()
                    };
                    
                    await executeDB('products', 'readwrite', store => 
                        store.put(productData)
                    );
                    
                    fetchedProductsCount++;
                }
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢Ù…Ø§Ø± ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§
                totalAttributesCount += attributesCount;
                document.getElementById('fetchedAttributes').textContent = totalAttributesCount.toLocaleString();
                
                indexedPages.add(page);
                await executeDB('indexed_pages', 'readwrite', store => 
                    store.put({ page: page, timestamp: Date.now() })
                );
                
                updateIndexStats();
                logIndex(`ØµÙØ­Ù‡ ${page} Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø´Ø¯ (${products.length} Ù…Ø­ØµÙˆÙ„, ${attributesCount} ÙˆÛŒÚ˜Ú¯ÛŒ)`, 'success');
                
            } catch (error) {
                logIndex(`Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒÙ†Ø¯Ú©Ø³ ØµÙØ­Ù‡ ${page}: ${error.message}`, 'error');
                throw error;
            }
        }

        async function pauseIndexing() {
            if (!isIndexing) return;
            
            isPaused = true;
            document.getElementById('pauseBtn').disabled = true;
            document.getElementById('continueBtn').style.display = 'block';
            
            await saveIndexState();
            logIndex('Ø§ÛŒÙ†Ø¯Ú©Ø³ Ù…ØªÙˆÙ‚Ù Ø´Ø¯. ÙˆØ¶Ø¹ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.', 'warning');
        }

        async function continueIndexing() {
            if (!isIndexing || !isPaused) return;
            
            isPaused = false;
            document.getElementById('pauseBtn').disabled = false;
            document.getElementById('continueBtn').style.display = 'none';
            
            logIndex('Ø§Ø¯Ø§Ù…Ù‡ Ø§ÛŒÙ†Ø¯Ú©Ø³...', 'info');
            startIndexing();
        }

        async function resetIndexing() {
            if (!confirm('Ø¢ÛŒØ§ Ø§Ø² Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† Ø§ÛŒÙ†Ø¯Ú©Ø³ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ ÙˆØ¶Ø¹ÛŒØª ØµÙØ­Ø§Øª Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø´Ø¯Ù‡ Ø±Ø§ Ù¾Ø§Ú© Ù…ÛŒâ€ŒÚ©Ù†Ø¯.')) {
                return;
            }
            
            try {
                await executeDB('indexed_pages', 'readwrite', store => store.clear());
                await executeDB('index_state', 'readwrite', store => store.clear());
                await executeDB('index_log', 'readwrite', store => store.clear());
                await executeDB('product_attributes', 'readwrite', store => store.clear());
                await executeDB('attribute_stats', 'readwrite', store => store.clear());
                
                indexedPages.clear();
                fetchedProductsCount = 0;
                totalAttributesCount = 0;
                allAttributes.clear();
                
                updateIndexStats();
                document.getElementById('indexLogContainer').innerHTML = '';
                document.getElementById('fetchedAttributes').textContent = '0';
                log('ÙˆØ¶Ø¹ÛŒØª Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø±ÛŒØ³Øª Ø´Ø¯', 'warning');
            } catch (error) {
                showError('Ø®Ø·Ø§ Ø¯Ø± Ø±ÛŒØ³Øª Ø§ÛŒÙ†Ø¯Ú©Ø³');
            }
        }

        async function completeIndexing() {
            isIndexing = false;
            clearInterval(timerInterval);
            
            await saveIndexState();
            await updateAttributeStats();
            await extractAllAttributes();
            
            logIndex(`Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯! ${fetchedProductsCount} Ù…Ø­ØµÙˆÙ„ Ùˆ ${totalAttributesCount} ÙˆÛŒÚ˜Ú¯ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯`, 'success');
            alert('ÙØ±Ø¢ÛŒÙ†Ø¯ Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯!');
            
            await loadInitialData();
            updateIndexControls();
        }

        function startIndexTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                if (indexStartTime > 0) {
                    const elapsed = Date.now() - indexStartTime;
                    const minutes = Math.floor(elapsed / 60000);
                    const seconds = Math.floor((elapsed % 60000) / 1000);
                    
                    document.getElementById('elapsedTime').textContent = 
                        `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    
                    if (fetchedProductsCount > 0) {
                        const speed = Math.round(fetchedProductsCount / (elapsed / 1000));
                        document.getElementById('indexSpeed').textContent = `${speed}/Ø«Ø§Ù†ÛŒÙ‡`;
                    }
                    
                    const progress = totalProductsCount > 0 ? 
                        Math.round((fetchedProductsCount / totalProductsCount) * 100) : 0;
                    document.getElementById('progressText').textContent = `${progress}%`;
                    document.getElementById('progressFill').style.width = `${progress}%`;
                }
            }, 1000);
        }

        function updateIndexControls() {
            document.getElementById('startIndexBtn').disabled = isIndexing;
            document.getElementById('pauseBtn').disabled = !isIndexing;
        }

        function updateIndexStats() {
            const lastPage = indexedPages.size > 0 ? Math.max(...Array.from(indexedPages)) : 0;
            document.getElementById('currentPageIndex').textContent = lastPage;
            document.getElementById('fetchedProducts').textContent = fetchedProductsCount.toLocaleString();
        }

        // =========== Ù…Ø¯ÛŒØ±ÛŒØª ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø­ØµÙˆÙ„ ===========
        async function extractAllAttributes() {
            try {
                allAttributes.clear();
                
                // Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ Ø§Ø² Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡
                const attributes = await executeDB('product_attributes', 'readonly', store => 
                    store.getAll()
                );
                
                for (const attr of attributes) {
                    if (!allAttributes.has(attr.attributeName)) {
                        allAttributes.set(attr.attributeName, new Set());
                    }
                    allAttributes.get(attr.attributeName).add(attr.attributeValue);
                }
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢Ù…Ø§Ø±
                totalAttributesCount = attributes.length;
                document.getElementById('totalAttributes').textContent = allAttributes.size.toLocaleString();
                document.getElementById('totalSavedAttributes').textContent = totalAttributesCount.toLocaleString();
                
                log(`Ø§Ø³ØªØ®Ø±Ø§Ø¬ ${allAttributes.size} ÙˆÛŒÚ˜Ú¯ÛŒ Ù…Ù†Ø­ØµØ± Ø¨Ù‡ ÙØ±Ø¯ Ø§Ø² Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡`, 'success');
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§:', error);
            }
        }

        async function updateAttributeStats() {
            try {
                // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¢Ù…Ø§Ø± ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§
                const attributeCounts = new Map();
                const attributes = await executeDB('product_attributes', 'readonly', store => 
                    store.getAll()
                );
                
                for (const attr of attributes) {
                    if (!attributeCounts.has(attr.attributeName)) {
                        attributeCounts.set(attr.attributeName, 0);
                    }
                    attributeCounts.set(attr.attributeName, attributeCounts.get(attr.attributeName) + 1);
                }
                
                // Ø°Ø®ÛŒØ±Ù‡ Ø¢Ù…Ø§Ø± Ø¯Ø± Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡
                for (const [attrName, count] of attributeCounts) {
                    await executeDB('attribute_stats', 'readwrite', store => 
                        store.put({
                            attributeName: attrName,
                            count: count,
                            lastUpdated: new Date().toISOString()
                        })
                    );
                }
                
                log(`Ø¢Ù…Ø§Ø± ${attributeCounts.size} ÙˆÛŒÚ˜Ú¯ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯`, 'info');
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢Ù…Ø§Ø± ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§:', error);
            }
        }

        async function generateAttributeFilters() {
            const container = document.getElementById('attributeFiltersContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† ØªØ¹Ø¯Ø§Ø¯ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ÛŒ
            const attributesArray = Array.from(allAttributes.entries());
            const displayCount = Math.min(appConfig.maxAttributesForFilter, attributesArray.length);
            
            // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ ÙØ±Ø§ÙˆØ§Ù†ÛŒ
            const sortedAttributes = attributesArray.slice(0, displayCount).sort((a, b) => {
                return b[1].size - a[1].size; // Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ¹Ø¯Ø§Ø¯ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù…Ù†Ø­ØµØ± Ø¨Ù‡ ÙØ±Ø¯
            });
            
            for (let i = 0; i < sortedAttributes.length; i++) {
                const [attrName, optionsSet] = sortedAttributes[i];
                const options = Array.from(optionsSet).sort();
                
                const filterDiv = document.createElement('div');
                filterDiv.className = 'attribute-filter-group';
                filterDiv.innerHTML = `
                    <div class="attribute-filter-header" onclick="toggleAttributeOptions(${i})">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span class="icon" id="attrToggleIcon_${i}">â–¶ï¸</span>
                            <span style="font-weight: 600; color: var(--text-primary);">${attrName}</span>
                            <span class="attribute-stat">${options.length}</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 4px;">
                            <button class="action-btn" onclick="selectAllAttributeOptions('${attrName}', event)" style="font-size: 10px; padding: 2px 6px;">
                                Ù‡Ù…Ù‡
                            </button>
                            <button class="action-btn" onclick="clearAttributeOptions('${attrName}', event)" style="font-size: 10px; padding: 2px 6px;">
                                Ù¾Ø§Ú©
                            </button>
                        </div>
                    </div>
                    <div class="attribute-filter-options" id="attrOptions_${i}" style="display: none;">
                        ${options.map(opt => `
                            <label class="attribute-filter-option">
                                <input type="checkbox" 
                                       class="attribute-checkbox"
                                       data-attribute="${attrName}"
                                       value="${opt}"
                                       ${attributeFilters.has(attrName) && attributeFilters.get(attrName).has(opt) ? 'checked' : ''}
                                       onchange="updateAttributeFilter('${attrName}', '${opt}', this)">
                                <span>${opt}</span>
                            </label>
                        `).join('')}
                    </div>
                `;
                container.appendChild(filterDiv);
            }
            
            updateActiveAttributeFilterCount();
        }

        function toggleAttributeFilters() {
            const content = document.getElementById('attributeFiltersContent');
            const icon = document.getElementById('attributeFilterIcon');
            
            if (content.style.display === 'none' || !content.style.display) {
                content.style.display = 'block';
                icon.textContent = 'ğŸ”¼';
            } else {
                content.style.display = 'none';
                icon.textContent = 'ğŸ”½';
            }
        }

        function toggleAttributeOptions(index) {
            const optionsDiv = document.getElementById(`attrOptions_${index}`);
            const icon = document.getElementById(`attrToggleIcon_${index}`);
            
            if (optionsDiv.style.display === 'none' || !optionsDiv.style.display) {
                optionsDiv.style.display = 'block';
                icon.textContent = 'ğŸ”½';
            } else {
                optionsDiv.style.display = 'none';
                icon.textContent = 'â–¶ï¸';
            }
        }

        function updateAttributeFilter(attrName, value, checkbox) {
            if (!attributeFilters.has(attrName)) {
                attributeFilters.set(attrName, new Set());
            }
            
            const attrSet = attributeFilters.get(attrName);
            
            if (checkbox.checked) {
                attrSet.add(value);
            } else {
                attrSet.delete(value);
                if (attrSet.size === 0) {
                    attributeFilters.delete(attrName);
                }
            }
            
            updateActiveAttributeFilterCount();
        }

        function selectAllAttributeOptions(attrName, event) {
            event.stopPropagation();
            
            if (!allAttributes.has(attrName)) return;
            
            if (!attributeFilters.has(attrName)) {
                attributeFilters.set(attrName, new Set());
            }
            
            const options = allAttributes.get(attrName);
            options.forEach(option => {
                attributeFilters.get(attrName).add(option);
            });
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú†Ú©â€ŒØ¨Ø§Ú©Ø³â€ŒÙ‡Ø§
            const checkboxes = document.querySelectorAll(`.attribute-checkbox[data-attribute="${attrName}"]`);
            checkboxes.forEach(cb => {
                cb.checked = true;
            });
            
            updateActiveAttributeFilterCount();
        }

        function clearAttributeOptions(attrName, event) {
            event.stopPropagation();
            
            attributeFilters.delete(attrName);
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú†Ú©â€ŒØ¨Ø§Ú©Ø³â€ŒÙ‡Ø§
            const checkboxes = document.querySelectorAll(`.attribute-checkbox[data-attribute="${attrName}"]`);
            checkboxes.forEach(cb => {
                cb.checked = false;
            });
            
            updateActiveAttributeFilterCount();
        }

        function clearAttributeFilters(event) {
            if (event) event.stopPropagation();
            
            if (!confirm('Ø¢ÛŒØ§ Ø§Ø² Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')) {
                return;
            }
            
            attributeFilters.clear();
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù‡Ù…Ù‡ Ú†Ú©â€ŒØ¨Ø§Ú©Ø³â€ŒÙ‡Ø§
            const checkboxes = document.querySelectorAll('.attribute-checkbox');
            checkboxes.forEach(cb => {
                cb.checked = false;
            });
            
            updateActiveAttributeFilterCount();
            applyFilters();
        }

        function updateActiveAttributeFilterCount() {
            activeAttributeFilterCount = 0;
            attributeFilters.forEach(values => {
                activeAttributeFilterCount += values.size;
            });
            
            document.getElementById('activeAttributeFilters').textContent = activeAttributeFilterCount;
        }

        function searchAttributes() {
            const searchTerm = document.getElementById('attributeSearch').value.toLowerCase();
            const filterGroups = document.querySelectorAll('.attribute-filter-group');
            
            filterGroups.forEach(group => {
                const header = group.querySelector('.attribute-filter-header');
                const attrName = header.querySelector('span:nth-child(2)').textContent.toLowerCase();
                
                if (attrName.includes(searchTerm)) {
                    group.style.display = 'block';
                } else {
                    group.style.display = 'none';
                }
            });
        }

        // =========== Ù…Ø¯ÛŒØ±ÛŒØª ØªÙ†Ø¸ÛŒÙ…Ø§Øª ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ ===========
        async function saveAttributeSettings() {
            appConfig.showAttributesInPopup = document.getElementById('showAttributesInPopup').checked;
            appConfig.showAttributesInFilters = document.getElementById('showAttributesInFilters').checked;
            appConfig.maxAttributesDisplay = parseInt(document.getElementById('maxAttributesDisplay').value) || 15;
            appConfig.maxAttributesForFilter = parseInt(document.getElementById('maxAttributesForFilter').value) || 20;
            appConfig.attributeSearchPrecision = document.getElementById('attributeSearchPrecision').value;
            
            await saveSettings();
            
            if (appConfig.showAttributesInFilters && allAttributes.size > 0) {
                generateAttributeFilters();
            }
            
            log('ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù†Ù…Ø§ÛŒØ´ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯', 'success');
            alert('ØªÙ†Ø¸ÛŒÙ…Ø§Øª ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.');
        }

        async function refreshAttributesList() {
            await extractAllAttributes();
            displayAttributesList();
            log('Ù„ÛŒØ³Øª ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯', 'success');
        }

        function displayAttributesList() {
            const container = document.getElementById('attributesListContainer');
            container.innerHTML = '';
            
            if (allAttributes.size === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: var(--text-secondary);">
                        <span class="icon">ğŸ·ï¸</span>
                        <p>Ù‡ÛŒÚ† ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯. Ø§Ø¨ØªØ¯Ø§ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø±Ø§ Ø§ÛŒÙ†Ø¯Ú©Ø³ Ú©Ù†ÛŒØ¯.</p>
                    </div>
                `;
                return;
            }
            
            const attributesArray = Array.from(allAttributes.entries());
            
            attributesArray.forEach(([attrName, optionsSet], index) => {
                const attrDiv = document.createElement('div');
                attrDiv.className = 'filter-row';
                attrDiv.style.padding = '8px';
                attrDiv.style.borderBottom = '1px solid var(--border)';
                
                const isSelected = appConfig.selectedAttributesForFilter.includes(attrName);
                
                attrDiv.innerHTML = `
                    <label class="filter-checkbox" style="flex: 1;">
                        <input type="checkbox" 
                               class="attribute-select-checkbox"
                               data-attribute="${attrName}"
                               ${isSelected ? 'checked' : ''}>
                        <span style="font-weight: 600; color: var(--text-primary);">${attrName}</span>
                        <span style="color: var(--text-light); font-size: 11px; margin-right: 8px;">
                            (${optionsSet.size} Ù…Ù‚Ø¯Ø§Ø±)
                        </span>
                    </label>
                    <div style="display: flex; gap: 4px;">
                        <button class="action-btn" onclick="previewAttributeValues('${attrName}')" style="font-size: 10px; padding: 2px 6px;">
                            <span class="icon">ğŸ‘ï¸</span>
                        </button>
                    </div>
                `;
                container.appendChild(attrDiv);
            });
        }

        function selectAllAttributesForFilter() {
            const checkboxes = document.querySelectorAll('.attribute-select-checkbox');
            checkboxes.forEach(cb => {
                cb.checked = true;
            });
        }

        function deselectAllAttributesForFilter() {
            const checkboxes = document.querySelectorAll('.attribute-select-checkbox');
            checkboxes.forEach(cb => {
                cb.checked = false;
            });
        }

        async function saveSelectedAttributes() {
            const checkboxes = document.querySelectorAll('.attribute-select-checkbox');
            const selected = [];
            
            checkboxes.forEach(cb => {
                if (cb.checked) {
                    selected.push(cb.getAttribute('data-attribute'));
                }
            });
            
            appConfig.selectedAttributesForFilter = selected;
            await saveSettings();
            
            log(`${selected.length} ÙˆÛŒÚ˜Ú¯ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± ÙÛŒÙ„ØªØ±Ù‡Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯`, 'success');
            alert(`ØªØ¹Ø¯Ø§Ø¯ ${selected.length} ÙˆÛŒÚ˜Ú¯ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± ÙÛŒÙ„ØªØ±Ù‡Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯.`);
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙÛŒÙ„ØªØ±Ù‡Ø§
            if (appConfig.showAttributesInFilters) {
                generateAttributeFilters();
            }
        }

        function previewAttributeValues(attrName) {
            if (!allAttributes.has(attrName)) return;
            
            const values = Array.from(allAttributes.get(attrName)).sort();
            const preview = values.slice(0, 10).join('ØŒ ');
            const more = values.length > 10 ? ` Ùˆ ${values.length - 10} Ù…ÙˆØ±Ø¯ Ø¯ÛŒÚ¯Ø±` : '';
            
            alert(`Ù…Ù‚Ø§Ø¯ÛŒØ± ÙˆÛŒÚ˜Ú¯ÛŒ "${attrName}":\n\n${preview}${more}\n\nØªØ¹Ø¯Ø§Ø¯ Ú©Ù„: ${values.length}`);
        }

        // =========== Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ ===========
        async function loadInitialData() {
            try {
                allProducts = await executeDB('products', 'readonly', store => store.getAll());
                filteredProducts = [...allProducts];
                
                const edits = await executeDB('price_edits', 'readonly', store => store.getAll());
                edits.forEach(edit => {
                    priceEdits.set(edit.productId, edit.newPrice);
                });
                
                await loadSyncQueue();
                await extractAllAttributes();
                
                updateStats();
                updateCategoryFilter();
                
                if (appConfig.showAttributesInFilters && allAttributes.size > 0) {
                    generateAttributeFilters();
                }
                
                sortProducts();
                displayProducts();
                updatePendingChanges();
                
                log('Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯', 'success');
            } catch (error) {
                log(`Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§: ${error.message}`, 'error');
            }
        }

        function updateStats() {
            const totalProducts = allProducts.length;
            const editedProducts = priceEdits.size;
            
            let totalPrice = 0;
            let totalYield = 0;
            let priceCount = 0;
            let yieldCount = 0;
            
            allProducts.forEach(product => {
                if (product.price > 0) {
                    totalPrice += product.price;
                    priceCount++;
                }
                if (product.price_per_gram > 0) {
                    totalYield += product.price_per_gram;
                    yieldCount++;
                }
            });
            
            const avgPrice = priceCount > 0 ? Math.round(totalPrice / priceCount) : 0;
            const avgYield = yieldCount > 0 ? Math.round(totalYield / yieldCount) : 0;
            
            document.getElementById('totalProducts').textContent = totalProducts.toLocaleString();
            document.getElementById('indexedProducts').textContent = fetchedProductsCount.toLocaleString();
            document.getElementById('editedProducts').textContent = editedProducts.toLocaleString();
            document.getElementById('lastSync').textContent = appConfig.lastSyncTime ? 
                new Date(appConfig.lastSyncTime).toLocaleTimeString('fa-IR') : '---';
            document.getElementById('avgPrice').textContent = `${avgPrice.toLocaleString()} ØªÙˆÙ…Ø§Ù†`;
            document.getElementById('totalAttributes').textContent = allAttributes.size.toLocaleString();
            document.getElementById('editedCount').textContent = editedProducts.toLocaleString();
        }

        // =========== Ø³ÛŒØ³ØªÙ… Ø§Ù†ØªØ®Ø§Ø¨ Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ ===========
        function initColumnSelector() {
            const container = document.getElementById('columnSelector');
            container.innerHTML = '';
            
            Object.entries(columnDefinitions).forEach(([key, column]) => {
                const option = document.createElement('div');
                option.className = `column-option ${appConfig.visibleColumns[key] ? 'selected' : ''}`;
                option.innerHTML = `
                    <span class="icon">${appConfig.visibleColumns[key] ? 'â˜‘ï¸' : 'â¬œ'}</span>
                    <span>${column.label}</span>
                `;
                option.onclick = () => {
                    appConfig.visibleColumns[key] = !appConfig.visibleColumns[key];
                    option.classList.toggle('selected');
                    option.querySelector('.icon').textContent = appConfig.visibleColumns[key] ? 'â˜‘ï¸' : 'â¬œ';
                };
                container.appendChild(option);
            });
        }

        async function saveColumnSettings() {
            try {
                await saveSettings();
                createTableHeader();
                displayProducts();
                log('ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù†Ù…Ø§ÛŒØ´ Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯', 'success');
                alert('ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù†Ù…Ø§ÛŒØ´ Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.');
            } catch (error) {
                showError('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù†Ù…Ø§ÛŒØ´');
            }
        }

        function createTableHeader() {
            const header = document.getElementById('tableHeader');
            header.innerHTML = '';
            
            // Ø³ØªÙˆÙ† Ø§Ù†ØªØ®Ø§Ø¨
            if (appConfig.visibleColumns.id) {
                header.innerHTML += `
                    <th class="checkbox-cell">
                        <input type="checkbox" id="selectAllCheckbox" class="selection-checkbox" onchange="toggleSelectAll(this)">
                    </th>
                `;
            }
            
            // Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø±
            Object.entries(columnDefinitions).forEach(([key, column]) => {
                if (appConfig.visibleColumns[key]) {
                    if (column.sortable) {
                        header.innerHTML += `
                            <th class="sortable" onclick="sortTable('${column.key}')">${column.label}</th>
                        `;
                    } else {
                        header.innerHTML += `
                            <th>${column.label}</th>
                        `;
                    }
                }
            });
        }

        // =========== Ø§Ø¹Ù…Ø§Ù„ ÙÛŒÙ„ØªØ±Ù‡Ø§ ===========
        function searchProducts() {
            applyFilters();
        }

        function applyFilters() {
            const searchTerm = document.getElementById('quickSearch')?.value.toLowerCase() || '';
            const hideNoWeight = document.getElementById('hideNoWeight')?.checked || false;
            const hideNoPrice = document.getElementById('hideNoPrice')?.checked || false;
            const hideNoYield = document.getElementById('hideNoYield')?.checked || false;
            const category = document.getElementById('categoryFilter')?.value || '';
            const minPrice = parseFloat(document.getElementById('minPrice')?.value) || 0;
            const maxPrice = parseFloat(document.getElementById('maxPrice')?.value) || Infinity;
            const minYield = parseFloat(document.getElementById('minYield')?.value) || 0;
            const maxYield = parseFloat(document.getElementById('maxYield')?.value) || Infinity;
            
            let tempProducts = [...allProducts];
            let attributeMatchCount = 0;
            
            // Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…ØªÙ†ÛŒ
            if (searchTerm) {
                tempProducts = tempProducts.filter(product => {
                    const searchFields = [
                        product.name,
                        product.sku,
                        product.category,
                        product.slug
                    ].filter(Boolean).join(' ').toLowerCase();
                    
                    return searchFields.includes(searchTerm);
                });
            }
            
            // ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ
            if (hideNoWeight) tempProducts = tempProducts.filter(p => p.weight > 0);
            if (hideNoPrice) tempProducts = tempProducts.filter(p => p.price > 0);
            if (hideNoYield) tempProducts = tempProducts.filter(p => p.price_per_gram > 0);
            if (category) tempProducts = tempProducts.filter(p => p.category === category);
            tempProducts = tempProducts.filter(p => p.price >= minPrice && p.price <= maxPrice);
            tempProducts = tempProducts.filter(p => (p.price_per_gram || 0) >= minYield && (p.price_per_gram || 0) <= maxYield);
            
            // ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ ÙˆÛŒÚ˜Ú¯ÛŒ
            if (appConfig.showAttributesInFilters && attributeFilters.size > 0) {
                tempProducts = tempProducts.filter(product => {
                    if (!product.attributes || !Array.isArray(product.attributes)) {
                        return false;
                    }
                    
                    // Ø¨Ø±Ø§ÛŒ Ù‡Ø± ÙˆÛŒÚ˜Ú¯ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ø¨Ø±Ø±Ø³ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
                    for (const [attrName, selectedValues] of attributeFilters) {
                        const productAttr = product.attributes.find(attr => 
                            attr.name === attrName
                        );
                        
                        if (!productAttr || !productAttr.options) {
                            return false;
                        }
                        
                        // Ø¨Ø±Ø±Ø³ÛŒ ØªØ·Ø§Ø¨Ù‚ Ù…Ù‚Ø§Ø¯ÛŒØ±
                        const hasMatch = productAttr.options.some(option => 
                            selectedValues.has(option)
                        );
                        
                        if (!hasMatch) {
                            return false;
                        }
                    }
                    
                    attributeMatchCount++;
                    return true;
                });
            }
            
            filteredProducts = tempProducts;
            currentPage = 1;
            sortProducts();
            
            document.getElementById('resultsCount').textContent = filteredProducts.length.toLocaleString();
            document.getElementById('attributeMatchCount').textContent = attributeMatchCount.toLocaleString();
            updateSelectedCount();
        }

        // =========== Ù†Ù…Ø§ÛŒØ´ Ù…Ø­ØµÙˆÙ„Ø§Øª ===========
        function sortTable(column) {
            if (sortColumn === column) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortColumn = column;
                sortDirection = 'desc';
            }
            
            document.querySelectorAll('th.sortable').forEach(th => {
                th.classList.remove('asc', 'desc');
                if (th.textContent.includes(columnDefinitions[column]?.label || '')) {
                    th.classList.add(sortDirection);
                }
            });
            
            sortProducts();
        }

        function sortProducts() {
            filteredProducts.sort((a, b) => {
                let valA, valB;
                
                switch(sortColumn) {
                    case 'id':
                        valA = a.id;
                        valB = b.id;
                        break;
                    case 'name':
                        valA = a.name || '';
                        valB = b.name || '';
                        break;
                    case 'date_modified':
                        valA = new Date(a.date_modified);
                        valB = new Date(b.date_modified);
                        break;
                    case 'weight':
                        valA = a.weight || 0;
                        valB = b.weight || 0;
                        break;
                    case 'price_per_gram':
                        valA = a.price_per_gram || 0;
                        valB = b.price_per_gram || 0;
                        break;
                    case 'price':
                        valA = a.price || 0;
                        valB = b.price || 0;
                        break;
                    case 'yield_per_gram':
                        valA = a.price_per_gram || 0;
                        valB = b.price_per_gram || 0;
                        break;
                    default:
                        valA = 0;
                        valB = 0;
                }
                
                if (sortDirection === 'asc') {
                    return valA > valB ? 1 : -1;
                } else {
                    return valA < valB ? 1 : -1;
                }
            });
            
            displayProducts();
        }

        function displayProducts() {
            const rowsPerPage = appConfig.rowsPerPage || 15;
            const start = (currentPage - 1) * rowsPerPage;
            const end = start + rowsPerPage;
            const pageProducts = filteredProducts.slice(start, end);
            const tbody = document.getElementById('resultsTable');
            
            tbody.innerHTML = '';
            
            if (pageProducts.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="${Object.values(appConfig.visibleColumns).filter(v => v).length + 1}" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                            <span style="font-size: 48px; display: block; margin-bottom: 16px;">ğŸ“¦</span>
                            Ù…Ø­ØµÙˆÙ„ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯
                        </td>
                    </tr>
                `;
            } else {
                pageProducts.forEach(product => {
                    const row = document.createElement('tr');
                    let rowHTML = '';
                    
                    // Ø³ØªÙˆÙ† Ø§Ù†ØªØ®Ø§Ø¨
                    if (appConfig.visibleColumns.id) {
                        rowHTML += `
                            <td class="checkbox-cell">
                                <input type="checkbox" class="product-checkbox selection-checkbox" 
                                       data-id="${product.id}" 
                                       ${selectedProducts.has(product.id) ? 'checked' : ''}
                                       onchange="toggleProductSelection(${product.id}, this)">
                            </td>
                        `;
                    }
                    
                    // Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø±
                    Object.entries(columnDefinitions).forEach(([key, column]) => {
                        if (!appConfig.visibleColumns[key]) return;
                        
                        switch(key) {
                            case 'id':
                                rowHTML += `<td>${product.id}</td>`;
                                break;
                            case 'name':
                                rowHTML += `
                                    <td>
                                        <a href="#" class="product-link" onclick="showProductDetails(${product.id}); return false;">
                                            ${product.name}
                                        </a>
                                    </td>
                                `;
                                break;
                            case 'date_modified':
                                const dateModified = new Date(product.date_modified).toLocaleDateString('fa-IR');
                                rowHTML += `<td>${dateModified}</td>`;
                                break;
                            case 'weight':
                                const weight = product.weight > 0 ? `${product.weight.toLocaleString()} Ú¯Ø±Ù…` : '---';
                                rowHTML += `<td>${weight}</td>`;
                                break;
                            case 'price_per_gram':
                                const pricePerGram = product.price_per_gram > 0 ? 
                                    Math.round(product.price_per_gram).toLocaleString() : '---';
                                rowHTML += `
                                    <td>
                                        <span class="yield-badge">
                                            ${pricePerGram} ØªÙˆÙ…Ø§Ù†
                                        </span>
                                    </td>
                                `;
                                break;
                            case 'price':
                                const totalPrice = product.price > 0 ? 
                                    Math.round(product.price).toLocaleString() : '---';
                                rowHTML += `
                                    <td>
                                        <span class="price-badge">
                                            ${totalPrice} ØªÙˆÙ…Ø§Ù†
                                        </span>
                                    </td>
                                `;
                                break;
                            case 'yield_per_gram':
                                const yieldValue = product.price_per_gram > 0 ? 
                                    Math.round(product.price_per_gram).toLocaleString() : '---';
                                rowHTML += `
                                    <td>
                                        <span class="yield-badge">
                                            ${yieldValue} ØªÙˆÙ…Ø§Ù†
                                        </span>
                                    </td>
                                `;
                                break;
                            case 'new_price':
                                const newPrice = priceEdits.get(product.id) || '';
                                rowHTML += `
                                    <td>
                                        <div class="price-input-group">
                                            <input type="number" 
                                                   class="price-input" 
                                                   value="${newPrice}"
                                                   placeholder="Ù‚ÛŒÙ…Øª Ø¬Ø¯ÛŒØ¯"
                                                   id="priceInput_${product.id}"
                                                   onchange="savePrice(${product.id})">
                                            <button class="save-price-btn" onclick="savePrice(${product.id})">
                                                <span class="icon">ğŸ’¾</span>
                                            </button>
                                        </div>
                                    </td>
                                `;
                                break;
                            case 'actions':
                                rowHTML += `
                                    <td style="white-space: nowrap;">
                                        <button class="action-btn" onclick="showProductDetails(${product.id})" title="Ø¬Ø²Ø¦ÛŒØ§Øª">
                                            <span class="icon">â„¹ï¸</span>
                                        </button>
                                        <button class="action-btn" onclick="viewOnSite(${product.id})" title="Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø± Ø³Ø§ÛŒØª">
                                            <span class="icon">ğŸ”—</span>
                                        </button>
                                    </td>
                                `;
                                break;
                        }
                    });
                    
                    row.innerHTML = rowHTML;
                    tbody.appendChild(row);
                });
            }
            
            updatePagination();
        }

        function updatePagination() {
            const rowsPerPage = appConfig.rowsPerPage || 15;
            const totalPages = Math.ceil(filteredProducts.length / rowsPerPage);
            const paginationTop = document.getElementById('paginationTop');
            const paginationBottom = document.getElementById('paginationBottom');
            
            const createPaginationHTML = () => {
                if (totalPages <= 1) return '';
                
                let html = '';
                const maxVisible = 5;
                let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
                let endPage = Math.min(totalPages, startPage + maxVisible - 1);
                
                if (endPage - startPage + 1 < maxVisible) {
                    startPage = Math.max(1, endPage - maxVisible + 1);
                }
                
                if (currentPage > 1) {
                    html += `<button class="page-btn" onclick="changePage(${currentPage - 1})">â€¹</button>`;
                }
                
                if (startPage > 1) {
                    html += `<button class="page-btn" onclick="changePage(1)">1</button>`;
                    if (startPage > 2) {
                        html += `<span style="padding: 8px; color: var(--text-light);">...</span>`;
                    }
                }
                
                for (let i = startPage; i <= endPage; i++) {
                    html += `
                        <button class="page-btn ${i === currentPage ? 'active' : ''}" 
                                onclick="changePage(${i})">
                            ${i}
                        </button>
                    `;
                }
                
                if (endPage < totalPages) {
                    if (endPage < totalPages - 1) {
                        html += `<span style="padding: 8px; color: var(--text-light);">...</span>`;
                    }
                    html += `<button class="page-btn" onclick="changePage(${totalPages})">${totalPages}</button>`;
                }
                
                if (currentPage < totalPages) {
                    html += `<button class="page-btn" onclick="changePage(${currentPage + 1})">â€º</button>`;
                }
                
                return html;
            };
            
            const paginationHTML = createPaginationHTML();
            paginationTop.innerHTML = paginationHTML;
            paginationBottom.innerHTML = paginationHTML;
        }

        function changePage(page) {
            currentPage = page;
            displayProducts();
            document.querySelector('.products-table-container').scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }

        // =========== ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ ===========
        function toggleFilters() {
            const content = document.getElementById('filterContent');
            const icon = document.getElementById('filterToggleIcon');
            
            content.classList.toggle('expanded');
            icon.textContent = content.classList.contains('expanded') ? 'â–²' : 'â–¼';
        }

        async function testConnection() {
            const siteUrl = document.getElementById('siteUrl').value;
            const consumerKey = document.getElementById('consumerKey').value;
            const consumerSecret = document.getElementById('consumerSecret').value;
            
            if (!siteUrl || !consumerKey || !consumerSecret) {
                alert('Ù„Ø·ÙØ§ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø§ØªØµØ§Ù„ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯');
                return;
            }
            
            log('Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø§ÛŒØª...', 'info');
            
            try {
                const testUrl = `${siteUrl}/wp-json/wc/v3/products?per_page=1&consumer_key=${consumerKey}&consumer_secret=${consumerSecret}`;
                const response = await fetch(testUrl);
                
                if (response.ok) {
                    const total = parseInt(response.headers.get('X-WP-Total')) || 0;
                    log(`Ø§ØªØµØ§Ù„ Ù…ÙˆÙÙ‚! ØªØ¹Ø¯Ø§Ø¯ Ù…Ø­ØµÙˆÙ„Ø§Øª: ${total}`, 'success');
                    alert(`Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø§ÛŒØª Ø¨Ø±Ù‚Ø±Ø§Ø± Ø´Ø¯.\nØªØ¹Ø¯Ø§Ø¯ Ù…Ø­ØµÙˆÙ„Ø§Øª: ${total}`);
                } else {
                    throw new Error(`Ø®Ø·Ø§ÛŒ HTTP: ${response.status}`);
                }
            } catch (error) {
                log(`Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø§ÛŒØª: ${error.message}`, 'error');
                alert('Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø§ÛŒØª. Ù„Ø·ÙØ§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.');
            }
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
                tab.style.display = 'none';
            });
            
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const tabElement = document.getElementById(tabName + 'Tab');
            if (tabElement) {
                tabElement.classList.add('active');
                tabElement.style.display = 'block';
                
                document.querySelectorAll('.nav-tab').forEach(btn => {
                    if (btn.onclick && btn.onclick.toString().includes(tabName)) {
                        btn.classList.add('active');
                    }
                });
                
                switch(tabName) {
                    case 'sync':
                        loadSyncQueue();
                        break;
                    case 'index':
                        updateIndexStats();
                        break;
                    case 'settings':
                        initColumnSelector();
                        loadAttributeSettingsUI();
                        displayAttributesList();
                        break;
                    case 'log':
                        filterAllLogs('all');
                        break;
                }
            }
        }

        async function showProductDetails(productId) {
            try {
                const product = await executeDB('products', 'readonly', store => 
                    store.get(productId)
                );
                
                if (!product) {
                    alert('Ù…Ø­ØµÙˆÙ„ ÛŒØ§ÙØª Ù†Ø´Ø¯!');
                    return;
                }
                
                document.getElementById('modalTitle').textContent = product.name;
                
                // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ù‚Ø§Ø¯ÛŒØ±
                const weight = product.weight > 0 ? `${product.weight.toLocaleString()} Ú¯Ø±Ù…` : 'Ù†Ø§Ù…Ø´Ø®Øµ';
                const dimensions = product.dimensions ? 
                    `${product.dimensions.length} Ã— ${product.dimensions.width} Ã— ${product.dimensions.height} Ø³Ø§Ù†ØªÛŒÙ…ØªØ±` : 'Ù†Ø§Ù…Ø´Ø®Øµ';
                const pricePerGram = product.price_per_gram > 0 ? 
                    `${Math.round(product.price_per_gram).toLocaleString()} ØªÙˆÙ…Ø§Ù†` : '---';
                
                // Ø§ÛŒØ¬Ø§Ø¯ Ø¬Ø¯ÙˆÙ„ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§
                let attributesHTML = '';
                if (appConfig.showAttributesInPopup && product.attributes && product.attributes.length > 0) {
                    // Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† ØªØ¹Ø¯Ø§Ø¯ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ÛŒ
                    const displayAttributes = product.attributes.slice(0, appConfig.maxAttributesDisplay);
                    
                    attributesHTML = `
                        <div class="attribute-section-title">
                            <span class="icon">ğŸ·ï¸</span>
                            ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø­ØµÙˆÙ„
                            <span class="attribute-stat">${displayAttributes.length}</span>
                        </div>
                        
                        <div style="overflow-x: auto; margin-bottom: 24px;">
                            <table class="attributes-table">
                                <thead>
                                    <tr>
                                        <th style="width: 40%;">Ù†Ø§Ù… ÙˆÛŒÚ˜Ú¯ÛŒ</th>
                                        <th style="width: 60%;">Ù…Ù‚Ø§Ø¯ÛŒØ±</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    displayAttributes.forEach(attr => {
                        if (attr.name && attr.options && attr.options.length > 0) {
                            attributesHTML += `
                                <tr>
                                    <td class="attribute-name">${attr.name}</td>
                                    <td class="attribute-values">${attr.options.join('ØŒ ')}</td>
                                </tr>
                            `;
                        }
                    });
                    
                    attributesHTML += `
                                </tbody>
                            </table>
                    `;
                    
                    // Ù†Ù…Ø§ÛŒØ´ ØªØ¹Ø¯Ø§Ø¯ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¨ÛŒØ´ØªØ±
                    if (product.attributes.length > appConfig.maxAttributesDisplay) {
                        attributesHTML += `
                            <div style="margin-top: 8px; font-size: 11px; color: var(--text-light); text-align: center;">
                                + ${product.attributes.length - appConfig.maxAttributesDisplay} ÙˆÛŒÚ˜Ú¯ÛŒ Ø¯ÛŒÚ¯Ø±
                            </div>
                        `;
                    }
                    
                    attributesHTML += `</div>`;
                }
                
                // Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø­ØªÙˆØ§ÛŒ Ù…ÙˆØ¯Ø§Ù„
                const modalContent = document.getElementById('modalContent');
                modalContent.innerHTML = `
                    <div style="text-align: center; margin-bottom: 24px;">
                        ${product.image ? 
                            `<img src="${product.image}" alt="${product.name}" class="product-main-image">` : 
                            `<div style="padding: 40px; background: var(--bg-secondary); border-radius: var(--radius);">
                                <span style="font-size: 48px; color: var(--text-light);">ğŸ“¦</span>
                                <p style="margin-top: 12px; color: var(--text-light);">Ø¨Ø¯ÙˆÙ† ØªØµÙˆÛŒØ±</p>
                            </div>`
                        }
                    </div>
                    
                    <div class="product-details-grid">
                        <div class="detail-card">
                            <span class="detail-label">Ù‚ÛŒÙ…Øª Ù…Ø­ØµÙˆÙ„</span>
                            <span class="detail-value">${product.price > 0 ? product.price.toLocaleString() + ' ØªÙˆÙ…Ø§Ù†' : 'Ù†Ø§Ù…Ø´Ø®Øµ'}</span>
                        </div>
                        <div class="detail-card">
                            <span class="detail-label">Ù‚ÛŒÙ…Øª Ù‡Ø± Ú¯Ø±Ù…</span>
                            <span class="detail-value">${pricePerGram}</span>
                        </div>
                        <div class="detail-card">
                            <span class="detail-label">ÙˆØ²Ù† Ù…Ø­ØµÙˆÙ„</span>
                            <span class="detail-value">${weight}</span>
                        </div>
                        <div class="detail-card">
                            <span class="detail-label">Ø§Ø¨Ø¹Ø§Ø¯ Ù…Ø­ØµÙˆÙ„</span>
                            <span class="detail-value">${dimensions}</span>
                        </div>
                    </div>
                    
                    ${attributesHTML}
                    
                    <div style="margin-top: 24px; padding: 20px; background: var(--bg-secondary); border-radius: var(--radius);">
                        <div class="detail-label">Ø¢Ø¯Ø±Ø³ Ù…Ø­ØµÙˆÙ„ Ø¯Ø± Ø³Ø§ÛŒØª</div>
                        <div style="margin-top: 8px;">
                            <a href="${product.permalink}" target="_blank" style="color: var(--primary); word-break: break-all; display: block;">
                                ${product.permalink}
                            </a>
                        </div>
                    </div>
                    
                    <div style="margin-top: 32px; display: flex; gap: 12px;">
                        <button class="btn btn-primary" onclick="viewOnSite(${product.id})" style="flex: 1;">
                            <span class="icon">ğŸ”—</span> Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø± Ø³Ø§ÛŒØª
                        </button>
                        <button class="btn" onclick="closeModal()" style="flex: 1; background: var(--bg-secondary); color: var(--text-secondary);">
                            <span class="icon">âœ•</span> Ø¨Ø³ØªÙ†
                        </button>
                    </div>
                `;
                
                document.getElementById('productModal').style.display = 'flex';
                document.body.style.overflow = 'hidden';
            } catch (error) {
                log(`Ø®Ø·Ø§ Ø¯Ø± Ù†Ù…Ø§ÛŒØ´ Ø¬Ø²Ø¦ÛŒØ§Øª Ù…Ø­ØµÙˆÙ„: ${error.message}`, 'error');
            }
        }

        function closeModal(event) {
            if (!event || event.target.id === 'productModal') {
                document.getElementById('productModal').style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        }

        function viewOnSite(productId) {
            const product = allProducts.find(p => p.id === productId);
            if (product && product.permalink) {
                window.open(product.permalink, '_blank');
            } else {
                alert('Ù„ÛŒÙ†Ú© Ù…Ø­ØµÙˆÙ„ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª');
            }
        }

        function showPasswordModal() {
            document.getElementById('passwordModal').style.display = 'flex';
            document.getElementById('indexPasswordInput').focus();
        }

        function closePasswordModal() {
            document.getElementById('passwordModal').style.display = 'none';
            document.getElementById('indexPasswordInput').value = '';
        }

        function confirmIndexPassword() {
            const password = document.getElementById('indexPasswordInput').value;
            
            if (password === INDEX_PASSWORD) {
                closePasswordModal();
                startIndexing();
            } else {
                alert('Ø±Ù…Ø² Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª! Ø±Ù…Ø² ØµØ­ÛŒØ­: 4481');
                document.getElementById('indexPasswordInput').value = '';
                document.getElementById('indexPasswordInput').focus();
            }
        }

        // =========== ØªÙˆØ§Ø¨Ø¹ Ø¨Ø§Ù‚ÛŒ Ù…Ø§Ù†Ø¯Ù‡ ===========
        async function loadAppConfig() {
            try {
                const config = await executeDB('app_config', 'readonly', store => 
                    store.get('app_config')
                );
                
                if (config && config.value) {
                    appConfig = { ...appConfig, ...config.value };
                    updateConfigUI();
                    loadAttributeSettingsUI();
                    initColumnSelector();
                    createTableHeader();
                }
            } catch (error) {
                console.log('Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶');
            }
        }

        function loadAttributeSettingsUI() {
            document.getElementById('showAttributesInPopup').checked = appConfig.showAttributesInPopup;
            document.getElementById('showAttributesInFilters').checked = appConfig.showAttributesInFilters;
            document.getElementById('maxAttributesDisplay').value = appConfig.maxAttributesDisplay;
            document.getElementById('maxAttributesForFilter').value = appConfig.maxAttributesForFilter;
            document.getElementById('attributeSearchPrecision').value = appConfig.attributeSearchPrecision;
        }

        function updateConfigUI() {
            const siteUrlInput = document.getElementById('siteUrl');
            const consumerKeyInput = document.getElementById('consumerKey');
            const consumerSecretInput = document.getElementById('consumerSecret');
            const perPageInput = document.getElementById('perPage');
            const rowsPerPageInput = document.getElementById('rowsPerPage');
            
            if (siteUrlInput) siteUrlInput.value = appConfig.siteUrl;
            if (consumerKeyInput) consumerKeyInput.value = appConfig.consumerKey;
            if (consumerSecretInput) consumerSecretInput.value = appConfig.consumerSecret;
            if (perPageInput) perPageInput.value = appConfig.perPage;
            if (rowsPerPageInput) rowsPerPageInput.value = appConfig.rowsPerPage;
        }

        async function saveSettings() {
            appConfig = {
                siteUrl: document.getElementById('siteUrl').value,
                consumerKey: document.getElementById('consumerKey').value,
                consumerSecret: document.getElementById('consumerSecret').value,
                perPage: parseInt(document.getElementById('perPage').value) || 50,
                rowsPerPage: parseInt(document.getElementById('rowsPerPage').value) || 15,
                hideNoWeight: appConfig.hideNoWeight || true,
                autoSync: appConfig.autoSync || true,
                lastSyncTime: appConfig.lastSyncTime,
                theme: appConfig.theme,
                visibleColumns: appConfig.visibleColumns,
                showAttributesInPopup: appConfig.showAttributesInPopup,
                showAttributesInFilters: appConfig.showAttributesInFilters,
                maxAttributesDisplay: appConfig.maxAttributesDisplay,
                maxAttributesForFilter: appConfig.maxAttributesForFilter,
                attributeSearchPrecision: appConfig.attributeSearchPrecision,
                selectedAttributesForFilter: appConfig.selectedAttributesForFilter
            };

            try {
                await executeDB('app_config', 'readwrite', store => 
                    store.put({
                        key: 'app_config',
                        value: appConfig,
                        timestamp: Date.now()
                    })
                );
                
                log('ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯', 'success');
            } catch (error) {
                log('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª: ' + error.message, 'error');
            }
        }

        async function saveIndexState() {
            try {
                await executeDB('index_state', 'readwrite', store => 
                    store.put({
                        id: 'index_state',
                        indexedPages: Array.from(indexedPages),
                        fetchedCount: fetchedProductsCount,
                        attributesCount: totalAttributesCount,
                        lastIndexed: new Date().toISOString(),
                        totalProducts: totalProductsCount
                    })
                );
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ ÙˆØ¶Ø¹ÛŒØª Ø§ÛŒÙ†Ø¯Ú©Ø³:', error);
            }
        }

        async function loadIndexState() {
            try {
                const state = await executeDB('index_state', 'readonly', store => 
                    store.get('index_state')
                );
                
                if (state) {
                    indexedPages = new Set(state.indexedPages || []);
                    fetchedProductsCount = state.fetchedCount || 0;
                    totalAttributesCount = state.attributesCount || 0;
                    
                    const lastPage = indexedPages.size > 0 ? Math.max(...Array.from(indexedPages)) : 0;
                    document.getElementById('lastIndexedPage').textContent = lastPage;
                    document.getElementById('lastIndexedDate').textContent = state.lastIndexed ? 
                        new Date(state.lastIndexed).toLocaleString('fa-IR') : '---';
                    document.getElementById('totalSavedAttributes').textContent = totalAttributesCount.toLocaleString();
                    document.getElementById('fetchedAttributes').textContent = totalAttributesCount.toLocaleString();
                }
            } catch (error) {
                console.log('ÙˆØ¶Ø¹ÛŒØª Ø§ÛŒÙ†Ø¯Ú©Ø³ ÛŒØ§ÙØª Ù†Ø´Ø¯');
            }
        }

        function updateCategoryFilter() {
            const filter = document.getElementById('categoryFilter');
            const currentValue = filter.value;
            filter.innerHTML = '<option value="">Ù‡Ù…Ù‡ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</option>';
            
            const categories = [...new Set(allProducts.map(p => p.category).filter(Boolean))];
            categories.sort();
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                filter.appendChild(option);
            });
            
            filter.value = currentValue;
        }

        // =========== Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ===========
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                await initDatabase();
                await loadAppConfig();
                await loadInitialData();
                await filterAllLogs('all');
                
                log('ÙˆØ¨â€ŒØ§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Radical Indexer Pro v3.5 Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª', 'success');
                
                const lastSync = appConfig.lastSyncTime ? 
                    new Date(appConfig.lastSyncTime).toLocaleString('fa-IR') : 'Ù‡Ø±Ú¯Ø²';
                document.getElementById('syncStatus').innerHTML = `
                    <span class="icon">ğŸ”„</span>
                    <span>Ø¢Ø®Ø±ÛŒÙ† Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ: ${lastSync}</span>
                `;
                
                // ØªÙ†Ø¸ÛŒÙ… ØªÙ…
                initTheme();
                
                // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† event listener Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡ ØªØºÛŒÛŒØ± ØªÙ…
                document.getElementById('themeToggle').addEventListener('click', toggleTheme);
                
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ:', error);
                log('Ø®Ø·Ø§ Ø¯Ø± Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†: ' + error.message, 'error');
            }
        });

        window.addEventListener('beforeunload', (e) => {
            if (isIndexing && !isPaused) {
                e.preventDefault();
                e.returnValue = 'ÙØ±Ø¢ÛŒÙ†Ø¯ Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§Ø³Øª. Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ØµÙØ­Ù‡ Ø±Ø§ ØªØ±Ú© Ú©Ù†ÛŒØ¯ØŸ';
                return e.returnValue;
            }
            
            if (pendingSyncCount > 0) {
                e.preventDefault();
                e.returnValue = 'ØªØºÛŒÛŒØ±Ø§Øª Ù‚ÛŒÙ…Øª Ù…Ù†ØªØ¸Ø± Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ù‡Ø³ØªÙ†Ø¯. Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ØµÙØ­Ù‡ Ø±Ø§ ØªØ±Ú© Ú©Ù†ÛŒØ¯ØŸ';
                return e.returnValue;
            }
        });

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(registration => {
                    console.log('ServiceWorker Ø«Ø¨Øª Ø´Ø¯:', registration);
                })
                .catch(error => {
                    console.log('Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª ServiceWorker:', error);
                });
        }

        // ØªÙˆØ§Ø¨Ø¹ Ù„Ø§Ú¯
        async function filterAllLogs(filterType) {
            const logElement = document.getElementById('activityLog');
            logElement.innerHTML = '';
            
            try {
                let logs = [];
                
                if (filterType === 'all') {
                    logs = await executeDB('activity_log', 'readonly', store => 
                        store.getAll()
                    );
                } else {
                    logs = await executeDB('activity_log', 'readonly', store => {
                        const index = store.index('type');
                        return index.getAll(filterType);
                    });
                }
                
                logs.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                logs.forEach(logItem => {
                    const timestamp = new Date(logItem.timestamp).toLocaleTimeString('fa-IR');
                    const logEntry = document.createElement('div');
                    logEntry.className = `log-entry ${logItem.type}`;
                    logEntry.innerHTML = `
                        <span>${logItem.message}</span>
                        <span class="log-time">${timestamp}</span>
                    `;
                    logElement.appendChild(logEntry);
                });
                
                updateLogCount();
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± ÙÛŒÙ„ØªØ± Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯â€ŒÙ‡Ø§:', error);
            }
        }

        async function updateLogCount() {
            try {
                const count = await executeDB('activity_log', 'readonly', store => 
                    store.count()
                );
                document.getElementById('logCount').textContent = count;
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø´Ù…Ø§Ø±Ø´ Ù„Ø§Ú¯â€ŒÙ‡Ø§:', error);
            }
        }

        async function updateIndexLogCount() {
            try {
                const count = await executeDB('index_log', 'readonly', store => 
                    store.count()
                );
                document.getElementById('indexLogCount').textContent = count;
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø´Ù…Ø§Ø±Ø´ Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ†Ø¯Ú©Ø³:', error);
            }
        }

        async function clearAllLogs() {
            if (!confirm('Ø¢ÛŒØ§ Ø§Ø² Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ù… Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')) return;
            
            try {
                await executeDB('activity_log', 'readwrite', store => store.clear());
                document.getElementById('activityLog').innerHTML = '';
                log('ØªÙ…Ø§Ù…ÛŒ Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø´Ø¯Ù†Ø¯', 'warning');
                updateLogCount();
            } catch (error) {
                showError('Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯â€ŒÙ‡Ø§');
            }
        }

        async function clearIndexLogs() {
            try {
                await executeDB('index_log', 'readwrite', store => store.clear());
                document.getElementById('indexLogContainer').innerHTML = '';
                logIndex('Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ†Ø¯Ú©Ø³ Ù¾Ø§Ú© Ø´Ø¯Ù†Ø¯', 'warning');
                updateIndexLogCount();
            } catch (error) {
                showError('Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ†Ø¯Ú©Ø³');
            }
        }

        async function exportAllLogs() {
            try {
                const logs = await executeDB('activity_log', 'readonly', store => 
                    store.getAll()
                );
                
                let csv = 'ØªØ§Ø±ÛŒØ®,Ø²Ù…Ø§Ù†,Ù†ÙˆØ¹,Ù¾ÛŒØ§Ù…\n';
                logs.forEach(log => {
                    const date = new Date(log.timestamp);
                    const dateStr = date.toLocaleDateString('fa-IR');
                    const timeStr = date.toLocaleTimeString('fa-IR');
                    csv += `"${dateStr}","${timeStr}","${log.type}","${log.message.replace(/"/g, '""')}"\n`;
                });
                
                const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `logs_${new Date().toISOString().slice(0,10)}.csv`;
                a.click();
                
                log('Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø®Ø±ÙˆØ¬ÛŒ Ú¯Ø±ÙØªÙ‡ Ø´Ø¯', 'success');
            } catch (error) {
                showError('Ø®Ø·Ø§ Ø¯Ø± Ø®Ø±ÙˆØ¬ÛŒ Ú¯Ø±ÙØªÙ† Ù„Ø§Ú¯â€ŒÙ‡Ø§');
            }
        }

        function showHelp() {
            alert(`
Radical Indexer Pro v3.5 - Ø±Ø§Ù‡Ù†Ù…Ø§

ğŸ“¦ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø­ØµÙˆÙ„Ø§Øª:
- Ø¬Ø³ØªØ¬Ùˆ Ùˆ ÙÛŒÙ„ØªØ± Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¯Ø± Ø¨Ø§Ù„Ø§ÛŒ Ø¬Ø¯ÙˆÙ„
- Ø§Ù†ØªØ®Ø§Ø¨ ØªÚ©ÛŒØŒ Ø¯Ø³ØªÙ‡â€ŒØ§ÛŒ Ùˆ Ú©Ù„ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª
- Ù‡Ø¯Ø± Ø¬Ø¯ÙˆÙ„ Ú†Ø³Ø¨Ù†Ø¯Ù‡ Ø¨Ù‡ Ø¨Ø§Ù„Ø§ÛŒ ØµÙØ­Ù‡
- ØµÙØ­Ù‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¯Ø± Ø¨Ø§Ù„Ø§ Ùˆ Ù¾Ø§ÛŒÛŒÙ† Ø¬Ø¯ÙˆÙ„

ğŸ·ï¸ Ù…Ø¯ÛŒØ±ÛŒØª ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø­ØµÙˆÙ„:
- Ø¯Ø±ÛŒØ§ÙØª Ø®ÙˆØ¯Ú©Ø§Ø± ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ Ø§Ø² Ø³Ø§ÛŒØª ÙˆÙˆÚ©Ø§Ù…Ø±Ø³
- Ù†Ù…Ø§ÛŒØ´ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ Ø¯Ø± Ø¬Ø¯ÙˆÙ„ Ø¯Ø§Ø®Ù„ Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ù…Ø­ØµÙˆÙ„
- ÙÛŒÙ„ØªØ± Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¨Ø± Ø§Ø³Ø§Ø³ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§
- Ø§Ù†ØªØ®Ø§Ø¨ Ú†Ù†Ø¯Ú¯Ø§Ù†Ù‡ Ù…Ù‚Ø§Ø¯ÛŒØ± Ø¨Ø±Ø§ÛŒ Ù‡Ø± ÙˆÛŒÚ˜Ú¯ÛŒ
- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù†Ù…Ø§ÛŒØ´ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ Ø¯Ø± ØªØ¨ ØªÙ†Ø¸ÛŒÙ…Ø§Øª

ğŸ” ÙÛŒÙ„ØªØ± Ù¾ÛŒØ´Ø±ÙØªÙ‡:
- Ø¬Ø³ØªØ¬ÙˆÛŒ Ø³Ø±ÛŒØ¹ Ø¯Ø± Ù†Ø§Ù…ØŒ SKU Ùˆ ØªÙˆØ¶ÛŒØ­Ø§Øª
- ÙÛŒÙ„ØªØ± Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
- ÙÛŒÙ„ØªØ± Ø¨Ø§Ø²Ù‡ Ù‚ÛŒÙ…Øª Ùˆ ÙˆØ²Ù†
- ÙÛŒÙ„ØªØ± Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¨Ø± Ø§Ø³Ø§Ø³ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø­ØµÙˆÙ„
- Ø§Ù†ØªØ®Ø§Ø¨ Ú†Ù†Ø¯Ú¯Ø§Ù†Ù‡ Ù…Ù‚Ø§Ø¯ÛŒØ± ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§

ğŸ’° ØªØºÛŒÛŒØ± Ù‚ÛŒÙ…Øª:
- Ø§ÙØ²Ø§ÛŒØ´/Ú©Ø§Ù‡Ø´ Ø¯Ø±ØµØ¯ÛŒ Ù‚ÛŒÙ…Øª
- Ø§Ø¹Ù…Ø§Ù„ Ø¨Ø± Ø±ÙˆÛŒ: Ù‡Ù…Ù‡ØŒ ÙÛŒÙ„ØªØ± Ø´Ø¯Ù‡ØŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
- Ù†Ù…Ø§ÛŒØ´ Ø®Ù„Ø§ØµÙ‡ ØªØºÛŒÛŒØ±Ø§Øª

ğŸ”„ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ:
- Ø¯Ú©Ù…Ù‡ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø± Ø¨Ø§Ù„Ø§ÛŒ Ø¬Ø¯ÙˆÙ„
- Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ ÛŒÚ©Ø¬Ø§ÛŒ Ù‡Ù…Ù‡ ØªØºÛŒÛŒØ±Ø§Øª
- Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§ Ùˆ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯

âš¡ Ø§ÛŒÙ†Ø¯Ú©Ø³ Ù‡ÙˆØ´Ù…Ù†Ø¯:
- Ø¯Ø±ÛŒØ§ÙØª Ø®ÙˆØ¯Ú©Ø§Ø± ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø­ØµÙˆÙ„ Ø§Ø² Ø³Ø§ÛŒØª
- Ø§Ø¯Ø§Ù…Ù‡ Ø§Ø² Ø¢Ø®Ø±ÛŒÙ† ØµÙØ­Ù‡
- Ù„Ø§Ú¯ Ø§Ø®ØªØµØ§ØµÛŒ Ø§ÛŒÙ†Ø¯Ú©Ø³
- Ù…Ù‚Ø§ÙˆÙ… Ø¯Ø± Ø¨Ø±Ø§Ø¨Ø± Ù‚Ø·Ø¹ Ø§Ø±ØªØ¨Ø§Ø·

ğŸ“‹ Ù„Ø§Ú¯ ÙØ¹Ø§Ù„ÛŒØª:
- Ù†Ù…Ø§ÛŒØ´ Ù‡Ù…Ù‡ Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ ÙÛŒÙ„ØªØ±
- Ø®Ø±ÙˆØ¬ÛŒ CSV
- Ù„Ø§Ú¯â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ú©Ø§Ù…Ù„ Ù‡Ù…Ù‡ Ø¹Ù…Ù„ÛŒØ§Øª

ğŸ’° Ù‚Ø§Ø¨Ù„ÛŒØª Ø¬Ø¯ÛŒØ¯: ØªØ¹Ø±ÛŒÙ Ù‚ÛŒÙ…Øª Ù‡Ø± Ú¯Ø±Ù… Ø¯Ø³ØªÙ‡â€ŒØ§ÛŒ
- ØªÙ†Ø¸ÛŒÙ… Ù‚ÛŒÙ…Øª ÙˆØ§Ø­Ø¯ (Ù‡Ø± Ú¯Ø±Ù…) Ùˆ Ø§Ø¹Ù…Ø§Ù„ Ø±ÙˆÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª
- Ø¯Ø§Ù…Ù†Ù‡: ØªÙ…Ø§Ù…ØŒ ÙÛŒÙ„ØªØ± Ø´Ø¯Ù‡ØŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
- Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø®ÙˆØ¯Ú©Ø§Ø± Ù‚ÛŒÙ…Øª Ú©Ù„ Ø¬Ø¯ÛŒØ¯ (ÙˆØ²Ù† Ã— Ù‚ÛŒÙ…Øª Ù‡Ø± Ú¯Ø±Ù…)
- Ø±Ø¯ Ø®ÙˆØ¯Ú©Ø§Ø± Ù…Ø­ØµÙˆÙ„Ø§Øª ÙØ§Ù‚Ø¯ ÙˆØ²Ù† Ù…Ø¹ØªØ¨Ø±
- Ù†Ù…Ø§ÛŒØ´ Ø®Ù„Ø§ØµÙ‡ ØªØºÛŒÛŒØ±Ø§Øª

âš ï¸ Ù†Ú©Ø§Øª Ù…Ù‡Ù…:
- Ø±Ù…Ø² Ø§ÛŒÙ†Ø¯Ú©Ø³: 4481
- ØªØºÛŒÛŒØ±Ø§Øª Ù‚ÛŒÙ…Øª Ø¨Ù„Ø§ÙØ§ØµÙ„Ù‡ Ø¯Ø± Ù„Ø§Ú¯ Ø«Ø¨Øª Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
- Ø¯Ø± ØµÙˆØ±Øª Ù‚Ø·Ø¹ Ø§ÛŒÙ†ØªØ±Ù†ØªØŒ ØªØºÛŒÛŒØ±Ø§Øª Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
- Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡
- ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø­ØµÙˆÙ„ Ø¨Ù‡ Ø·ÙˆØ± Ú©Ø§Ù…Ù„ Ø§Ø² Ø³Ø§ÛŒØª Ø¯Ø±ÛŒØ§ÙØª Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
            `);
        }

        // ØªÙˆØ§Ø¨Ø¹ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø¯Ù‡
        async function exportIndexedData() {
            try {
                const products = await executeDB('products', 'readonly', store => store.getAll());
                const edits = await executeDB('price_edits', 'readonly', store => store.getAll());
                const attributes = await executeDB('product_attributes', 'readonly', store => store.getAll());
                const config = await executeDB('app_config', 'readonly', store => store.get('app_config'));
                
                const data = {
                    products: products,
                    priceEdits: edits,
                    productAttributes: attributes,
                    config: config?.value || {},
                    metadata: {
                        exportedAt: new Date().toISOString(),
                        totalProducts: products.length,
                        totalEdits: edits.length,
                        totalAttributes: attributes.length,
                        appVersion: '3.5'
                    }
                };
                
                const jsonStr = JSON.stringify(data, null, 2);
                const blob = new Blob([jsonStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `radical_indexer_backup_${new Date().toISOString().slice(0,10)}.json`;
                a.click();
                
                log('Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø®Ø±ÙˆØ¬ÛŒ Ú¯Ø±ÙØªÙ‡ Ø´Ø¯', 'success');
            } catch (error) {
                showError('Ø®Ø·Ø§ Ø¯Ø± Ø®Ø±ÙˆØ¬ÛŒ Ú¯Ø±ÙØªÙ† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§');
            }
        }

        async function importIndexedData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                if (!confirm('Ø¢ÛŒØ§ Ø§Ø² ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø®ÙˆØ§Ù‡Ù†Ø¯ Ø´Ø¯.')) {
                    return;
                }
                
                try {
                    const text = await file.text();
                    const data = JSON.parse(text);
                    
                    await Promise.all([
                        executeDB('products', 'readwrite', store => store.clear()),
                        executeDB('price_edits', 'readwrite', store => store.clear()),
                        executeDB('product_attributes', 'readwrite', store => store.clear())
                    ]);
                    
                    if (data.products && Array.isArray(data.products)) {
                        for (const product of data.products) {
                            await executeDB('products', 'readwrite', store => store.put(product));
                        }
                    }
                    
                    if (data.priceEdits && Array.isArray(data.priceEdits)) {
                        for (const edit of data.priceEdits) {
                            await executeDB('price_edits', 'readwrite', store => store.put(edit));
                        }
                    }
                    
                    if (data.productAttributes && Array.isArray(data.productAttributes)) {
                        for (const attr of data.productAttributes) {
                            await executeDB('product_attributes', 'readwrite', store => store.put(attr));
                        }
                    }
                    
                    if (data.config) {
                        await executeDB('app_config', 'readwrite', store => 
                            store.put({
                                key: 'app_config',
                                value: data.config,
                                timestamp: Date.now()
                            })
                        );
                        appConfig = { ...appConfig, ...data.config };
                        updateConfigUI();
                        loadAttributeSettingsUI();
                    }
                    
                    log('Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù†Ø¯', 'success');
                    await loadInitialData();
                    alert('Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù†Ø¯.');
                } catch (error) {
                    showError('Ø®Ø·Ø§ Ø¯Ø± ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§. ÙØ§ÛŒÙ„ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª.');
                }
            };
            
            input.click();
        }

        async function clearAllData() {
            if (!confirm('Ø¢ÛŒØ§ Ø§Ø² Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ\nØ§ÛŒÙ† Ø¹Ù…Ù„ ØªÙ…Ø§Ù… Ù…Ø­ØµÙˆÙ„Ø§ØªØŒ ØªØºÛŒÛŒØ±Ø§Øª Ù‚ÛŒÙ…Øª Ùˆ Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ø±Ø§ Ù¾Ø§Ú© Ù…ÛŒâ€ŒÚ©Ù†Ø¯.\nØ§ÛŒÙ† Ø¹Ù…Ù„ Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ù†ÛŒØ³Øª!')) {
                return;
            }
            
            try {
                await Promise.all([
                    executeDB('products', 'readwrite', store => store.clear()),
                    executeDB('price_edits', 'readwrite', store => store.clear()),
                    executeDB('activity_log', 'readwrite', store => store.clear()),
                    executeDB('index_log', 'readwrite', store => store.clear()),
                    executeDB('indexed_pages', 'readwrite', store => store.clear()),
                    executeDB('index_state', 'readwrite', store => store.clear()),
                    executeDB('sync_queue', 'readwrite', store => store.clear()),
                    executeDB('product_attributes', 'readwrite', store => store.clear()),
                    executeDB('attribute_stats', 'readwrite', store => store.clear())
                ]);
                
                allProducts = [];
                filteredProducts = [];
                priceEdits.clear();
                indexedPages.clear();
                allAttributes.clear();
                attributeFilters.clear();
                selectedProducts.clear();
                fetchedProductsCount = 0;
                totalAttributesCount = 0;
                pendingSyncCount = 0;
                
                updateStats();
                displayProducts();
                updateIndexStats();
                updatePendingChanges();
                updateActiveAttributeFilterCount();
                
                log('ØªÙ…Ø§Ù…ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø´Ø¯Ù†Ø¯', 'warning');
                alert('ØªÙ…Ø§Ù…ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù¾Ø§Ú© Ø´Ø¯Ù†Ø¯.');
            } catch (error) {
                showError('Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§');
            }
        }

        async function backupDatabase() {
            await exportIndexedData();
        }

        async function restoreDatabase() {
            await importIndexedData();
        }

        async function optimizeDatabase() {
            try {
                log('Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù…...', 'info');
                await new Promise(resolve => setTimeout(resolve, 1000));
                log('Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯', 'success');
                alert('Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯.');
            } catch (error) {
                showError('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡');
            }
        }

        // ØªÙˆØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù‚ÛŒÙ…Øª
        function savePrice(productId) {
            const priceInput = document.getElementById(`priceInput_${productId}`);
            const newPrice = parseFloat(priceInput.value);
            
            if (isNaN(newPrice) || newPrice < 0) {
                showError('Ù„Ø·ÙØ§ Ù‚ÛŒÙ…Øª Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                priceInput.value = '';
                return;
            }
            
            updatePrice(productId, newPrice);
        }
    </script>
</body>
</html>
